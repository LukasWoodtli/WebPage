{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/blog/system_construction",
    "result": {"data":{"site":{"siteMetadata":{"title":"My personal Website"}},"markdownRemark":{"id":"e3dd2f48-11c2-5cf6-8bac-bc471905ee34","excerpt":"My Notes for the System Construction Course at ETH [TOC] Minos on Raspberry PI 2 (Case Study 1) ARM A7 The ARM Architecture is not the same thing as the ARM…","html":"<blockquote>\n<p>My Notes for the <em>System Construction</em> Course at ETH</p>\n</blockquote>\n<p>[TOC]</p>\n<h1 id=\"minos-on-raspberry-pi-2-case-study-1\">Minos on Raspberry PI 2 (Case Study 1)</h1>\n<h2 id=\"arm-a7\">ARM A7</h2>\n<p>The ARM <em>Architecture</em> is not the same thing as the ARM <em>Processor-Families</em></p>\n<h3 id=\"documentation\">Documentation</h3>\n<p>There is a lot of good documentation for the ARM processors available. But it’s difficult to\nfind the right documents.</p>\n<table>\n<thead>\n<tr>\n<th>Document</th>\n<th>Main Content</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ARM Architecture Reference Manual (ARMv7-AR, ARM ARM)</td>\n<td>Possibility of implementing the processor. For compilers and tools. Partly used for system programming</td>\n</tr>\n<tr>\n<td>ARM Technical System Reference (ARM Cortex-A7MPCore Family)</td>\n<td>Particular Implementation. Some redundant information to ARM ARM.</td>\n</tr>\n<tr>\n<td>System On Chip Implementation Manual (BCM 2835)</td>\n<td>How the core is embedded on the chip with peripherals. Address map. Peripheral information.</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"6-kinds-of-instructions\">6 Kinds Of Instructions</h3>\n<ol>\n<li>Data Processing</li>\n<li>Branch Instructions</li>\n<li>Status Register Transfer</li>\n<li>Load and Store (RISC)</li>\n<li>Generic Coprocessor Instructions</li>\n<li>Exception Generation</li>\n</ol>\n<ul>\n<li>Load-/Store: No memory operands (not as x86)\n<ul>\n<li>Load: from memory to register</li>\n<li>Store: from register to memory</li>\n</ul>\n</li>\n<li>Multiple-Data-Transfer commands (<code class=\"language-text\">stmdb sp!,{fp,lr}</code>, <code class=\"language-text\">!</code>: Write-Back)</li>\n<li>Link Register: <code class=\"language-text\">bl</code>: Branch-and-Link (stores PC in link register)</li>\n<li>PC-Relative Addressing: Loading large constants (that have no space in instruction encoding) form code</li>\n</ul>\n<h3 id=\"execution-modes\">Execution Modes</h3>\n<ul>\n<li>7 Modes</li>\n<li>for exception handling</li>\n<li>Processor starts in supervisor mode</li>\n<li>Registers are shadowed (banked) in different modes</li>\n<li>System Mode: privileged but same registers as user mode</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Privilege Level</th>\n<th>Mode</th>\n<th>Description/Cause</th>\n<th>Exception/Normal Execution</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>privileged</td>\n<td>Supervisor</td>\n<td>Reset / Software Interrupt</td>\n<td>exception</td>\n</tr>\n<tr>\n<td>privileged</td>\n<td>FIQ</td>\n<td>Fast Interrupt</td>\n<td>exception</td>\n</tr>\n<tr>\n<td>privileged</td>\n<td>IRQ</td>\n<td>Normal Interrupt</td>\n<td>exception</td>\n</tr>\n<tr>\n<td>privileged</td>\n<td>Abort</td>\n<td>Memory Access Violation</td>\n<td>exception</td>\n</tr>\n<tr>\n<td>privileged</td>\n<td>Undef</td>\n<td>Undefined Instruction</td>\n<td>exception</td>\n</tr>\n<tr>\n<td>privileged</td>\n<td>System</td>\n<td>Privileged Mode with same registers as in User Mode</td>\n<td>normal execution</td>\n</tr>\n<tr>\n<td><strong>un</strong>privileged</td>\n<td>User</td>\n<td>Regular Application Mode</td>\n<td>normal execution</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"special-registers\">Special Registers</h3>\n<ul>\n<li>R15: PC (Program Counter)</li>\n<li>R14: LR (Return address for procedure)</li>\n<li>R13: SP (‘top’ of the stack)</li>\n<li>R12: FP (by convention, stored SP before procedure call)</li>\n<li>CPSR (Processor Status Register)\n<ul>\n<li>Mode Bits</li>\n<li>IRQ Disable</li>\n<li>Condition Flags</li>\n<li>…</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"typical-procedure-call\">Typical Procedure Call</h3>\n<ul>\n<li>\n<p>Caller</p>\n<ul>\n<li>Pushes params</li>\n<li><code class=\"language-text\">BL #address</code>: Stores PC of next instruction in LR</li>\n</ul>\n</li>\n<li>\n<p>Callee</p>\n<ul>\n<li>Save LR and FP on stack: <code class=\"language-text\">stmdb sp!, {fp, lr}</code></li>\n<li>Set new FP: <code class=\"language-text\">mov fp, sp</code></li>\n<li>Execute procedure content</li>\n<li>Reset stack pointer: <code class=\"language-text\">mov lr, sp</code></li>\n<li>Restore FP and jump back to caller address: <code class=\"language-text\">ldmia sp!, {fp, pc}</code></li>\n</ul>\n</li>\n<li>\n<p>Caller</p>\n<ul>\n<li>Clean up parameters from stack: <code class=\"language-text\">add sp,sp, #n</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"exceptions\">Exceptions</h3>\n<ul>\n<li>Interrupt: asynchronous event triggered by a device signal</li>\n<li>Trap / Syscall: intentional exception</li>\n<li>Fault: error condition that a handler might be able to correct</li>\n<li>Abort: error condition that cannot be corrected</li>\n</ul>\n<h3 id=\"misc\">Misc</h3>\n<ul>\n<li>FIRQ is about having more stacked registers</li>\n<li>Return Link type: Different sizes because of pipe-line</li>\n</ul>\n<h2 id=\"raspberry-pi-2\">Raspberry PI 2</h2>\n<ul>\n<li>Quad Core</li>\n<li>1 GB RAM</li>\n<li>40 Pin GPIO, …</li>\n<li>UART, SPI, USB, Ethernet, …</li>\n<li>Powered from MicroUSB</li>\n</ul>\n<h3 id=\"booting\">Booting</h3>\n<ul>\n<li>Kernel is copied to address: <code class=\"language-text\">0x8000h</code> and branches there (instead to <code class=\"language-text\">0x00</code>)</li>\n<li>MMU is disabled</li>\n<li>Only one core is running</li>\n</ul>\n<h3 id=\"mmu\">MMU</h3>\n<ul>\n<li>Memory translation is complicated due to two different MMU’s</li>\n<li>ARM’s memory mapped registers start from <code class=\"language-text\">0x3f000000</code>, opposed to <code class=\"language-text\">0x7e000000</code> in BMC manual</li>\n</ul>\n<h3 id=\"gpio\">GPIO</h3>\n<ul>\n<li>Some GPIO Registers need Read-Modify-Write (i.e GPFSELn)</li>\n<li>Other Registers support setting or clearing single bits:\n<ul>\n<li>i.e Set GPIO Pin: GPSETn</li>\n<li>i.e Clear GPIO Pin: GPCLRn</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"minos-and-oberon\">Minos and Oberon</h2>\n<h3 id=\"history-of-oberon\">History of Oberon</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a94d7914738fffde7d665a4d9335bf4/13e20/syscon_oberon_history.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArElEQVQY042P4arDIAyFff/XbEuohsUoqdq6ZGwy77gw2PcrHJJzcpz9QO+91kpEzFxrRcScc2vNpZSWZfHehxBijGZWSgGAUop/QUQigojXdQ0vVR2DU9X7m6EOxcymfp5nSgkAiKi1hogAkHN29jPDdAaoqpvTfOZfspkdx5FS8t6POtPueZxzXteVmYckItu2icjoHGO8vfhs+3c8w79923tn5n3fQwifaw/NqpkeXFLkIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Oberon Language and OS Family\"\n        title=\"Oberon Language and OS Family\"\n        src=\"/static/6a94d7914738fffde7d665a4d9335bf4/f058b/syscon_oberon_history.png\"\n        srcset=\"/static/6a94d7914738fffde7d665a4d9335bf4/c26ae/syscon_oberon_history.png 158w,\n/static/6a94d7914738fffde7d665a4d9335bf4/6bdcf/syscon_oberon_history.png 315w,\n/static/6a94d7914738fffde7d665a4d9335bf4/f058b/syscon_oberon_history.png 630w,\n/static/6a94d7914738fffde7d665a4d9335bf4/13e20/syscon_oberon_history.png 741w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"oberon\">Oberon</h3>\n<ul>\n<li>Modules can be compiled separately</li>\n<li>Strongly typed\n<ul>\n<li>Static type checking at compile time</li>\n<li>Run-time support for type guards / tests</li>\n</ul>\n</li>\n<li>High Level (minimal Assembler code)</li>\n<li>Special low level functions in <code class=\"language-text\">SYSTEM</code> pseudo module (compiler directives)</li>\n</ul>\n<h4 id=\"oberon07\">Oberon07</h4>\n<ul>\n<li>Minimal</li>\n<li>No type <code class=\"language-text\">OBJECT*</code> no member functions (methods)</li>\n</ul>\n<h4 id=\"language-constructs\">Language Constructs</h4>\n<h5 id=\"program-units\">Program Units</h5>\n<ul>\n<li><code class=\"language-text\">MODULE</code></li>\n<li><code class=\"language-text\">PROCEDURE</code>\n<ul>\n<li>Value, <code class=\"language-text\">VAR</code> (in-out) and <code class=\"language-text\">CONST</code> parameters</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"data-types\">Data Types</h5>\n<ul>\n<li><code class=\"language-text\">BOOLEAN</code>, <code class=\"language-text\">CHAR</code>, <code class=\"language-text\">SHORTINT</code>, <code class=\"language-text\">INTEGER</code>, <code class=\"language-text\">LONGINT</code>, <code class=\"language-text\">HUGEINT</code>, <code class=\"language-text\">REAL</code>, <code class=\"language-text\">LONGREAL</code>, <code class=\"language-text\">SET</code>, <code class=\"language-text\">ADDRESS</code>, <code class=\"language-text\">SIZE</code></li>\n</ul>\n<h5 id=\"structured-types\">Structured Types</h5>\n<ul>\n<li><code class=\"language-text\">ARRAY</code>, <code class=\"language-text\">POINTER TO ARRAY</code></li>\n<li><code class=\"language-text\">RECORD</code> (with type extension), <code class=\"language-text\">POINTER TO RECORD</code></li>\n</ul>\n<h5 id=\"control-structures\">Control Structures</h5>\n<h6 id=\"if\"><code class=\"language-text\">IF</code></h6>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">IF</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token keyword\">THEN</span>\n    <span class=\"token comment\">(* statement sequence *)</span>\n<span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h6 id=\"while\"><code class=\"language-text\">WHILE</code></h6>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">WHILE</span> x<span class=\"token operator\">&lt;</span>n <span class=\"token keyword\">DO</span>\n    <span class=\"token comment\">(* statement sequence *)</span>\n<span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h6 id=\"repeat\"><code class=\"language-text\">REPEAT</code></h6>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">REPEAT</span>\n    <span class=\"token comment\">(* statement sequence *)</span>\n<span class=\"token keyword\">UNTIL</span> x<span class=\"token operator\">=</span>n<span class=\"token punctuation\">;</span></code></pre></div>\n<h6 id=\"for\"><code class=\"language-text\">FOR</code></h6>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">FOR</span> i <span class=\"token operator\">:=</span> <span class=\"token number\">0</span> <span class=\"token keyword\">TO</span> <span class=\"token number\">100</span> <span class=\"token keyword\">DO</span>\n    <span class=\"token comment\">(* statement seq *)</span>\n<span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"built-in-functions\">Built-in Functions</h5>\n<p>Increment and decrement</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">INC<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nDEC<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nINC<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nDEC<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Sets</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">INCL<span class=\"token punctuation\">(</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nEXCL<span class=\"token punctuation\">(</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Assert and Halt</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">ASSERT<span class=\"token punctuation\">(</span>b<span class=\"token operator\">&lt;</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nHALT<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Allocation</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">NEW</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Shifts</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">ASH<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nLSH<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nROT<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Conversion</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">SHORT<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nLONG<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nORD<span class=\"token punctuation\">(</span>ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nCHR<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nENTIER<span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Arrays</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">LEN<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nLEN<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nDIM<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Misc</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">ABS<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nMAX<span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nMIN<span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nODD<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nCAP<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Addresses and Sizes</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">ADDRESS <span class=\"token keyword\">OF</span> x<span class=\"token punctuation\">;</span>\nADDRESSOF<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSIZE <span class=\"token keyword\">OF</span> t<span class=\"token punctuation\">;</span>\nSIZEOF<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"modules\">Modules</h4>\n<ul>\n<li><code class=\"language-text\">PROCEDURE Write* ...</code>: Exported (<code class=\"language-text\">*</code>)</li>\n<li>Module body is executed first and only once</li>\n<li>Module can be loaded only once (keeps state, can be unloaded)</li>\n<li>Procedures without params can be executed as commands</li>\n<li>Comments: <code class=\"language-text\">(* ... *)</code></li>\n<li>Special Type: <code class=\"language-text\">SET</code> contains ints up to CPU bit size: i.e 1..32 (<code class=\"language-text\">{12, 5}</code>)</li>\n<li><code class=\"language-text\">SYSTEM</code> Pseudo Module\n<ul>\n<li>Unsafe!</li>\n<li>Memory Access</li>\n<li><code class=\"language-text\">SYSTEM.BYTE</code>: raw binary data (with length and bound checks)</li>\n<li>Type Casts: can be unsafe!</li>\n</ul>\n</li>\n<li>Procedure Flags:\n<ul>\n<li><code class=\"language-text\">INTERRUPT</code>: for ISR’s</li>\n<li><code class=\"language-text\">PCOFFSET=k</code>: offset for returning from ISR</li>\n</ul>\n</li>\n<li>Unsafe Pointer: can write to memory address</li>\n</ul>\n<h4 id=\"pseudo-module-system\">Pseudo Module <code class=\"language-text\">SYSTEM</code></h4>\n<p>Direct Memory Access Functions</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">SYSTEM<span class=\"token punctuation\">.</span>PUT <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>GET <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>PUT8|<span class=\"token number\">16</span>|<span class=\"token number\">32</span>|<span class=\"token number\">64</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nx <span class=\"token operator\">:=</span> SYSTEM<span class=\"token punctuation\">.</span>GET8|<span class=\"token number\">16</span>|<span class=\"token number\">32</span>|<span class=\"token number\">64</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>MOVE<span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> dest<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Data Type</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">SYSTEM<span class=\"token punctuation\">.</span>BYTE</code></pre></div>\n<p>Type Cast</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">b <span class=\"token operator\">:=</span> SYSTEM<span class=\"token punctuation\">.</span>VAL<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Example of Low-Level access</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">IMPORT SYSTEM<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">PROCEDURE</span> LetThereBeLight<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CONST</span> GPSET0 <span class=\"token operator\">=</span> <span class=\"token number\">03</span>F20001CH<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">BEGIN</span>\n    SYSTEM<span class=\"token punctuation\">.</span>PUT<span class=\"token punctuation\">(</span>GPSET0<span class=\"token punctuation\">,</span> <span class=\"token comment\">{21}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span> LetThereBeLight<span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"system-arm-specific\"><code class=\"language-text\">SYSTEM</code>: ARM Specific</h5>\n<p>Register Access</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">SYSTEM<span class=\"token punctuation\">.</span>SP<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>FP<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>LNK<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nSYSTEM<span class=\"token punctuation\">.</span>SETSP<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>SETFP<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>SETLR<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nSYSTEM<span class=\"token punctuation\">.</span>LDPSR<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>STPSR<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>LDCPR<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>STCPR<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>FLUSH<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Floating Point</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">SYSTEM<span class=\"token punctuation\">.</span>NULL<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSYSTEM<span class=\"token punctuation\">.</span>MULD<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"interrupt-procedures\">Interrupt Procedures</h5>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">PROCEDURE</span> Handler <span class=\"token comment\">{INTERRUPT, PCOFFSET=k}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">BEGIN</span> <span class=\"token comment\">(* k is the offset to the next instruction\n         cf. table of exceptions *)</span>\n<span class=\"token keyword\">END</span> Handler<span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"special-flags-and-features\">Special Flags and Features</h5>\n<p>Procedure without activation frame</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">PROCEDURE</span> <span class=\"token comment\">{NOTAG}</span></code></pre></div>\n<p>Procedure that is linked to the beginning of a kernel</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">PROCEDURE</span> <span class=\"token comment\">{INITIAL}</span></code></pre></div>\n<p>Inline assembler block</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">CODE <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">END</span></code></pre></div>\n<p>Alignment of a symbol (i. e variable)</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">symbol <span class=\"token comment\">{ALIGNED(32)}</span></code></pre></div>\n<p>Pinning of a symbol</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">symbol {FIXED<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>x8000<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Unsafe pointer that is assignment compatible with type <code class=\"language-text\">ADDRESS</code></p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">POINTER <span class=\"token comment\">{UNSAFE}</span> <span class=\"token keyword\">TO</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>Symbol that is invisible to a Garbage Collector</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">symbol <span class=\"token comment\">{UNTRACED}</span></code></pre></div>\n<h5 id=\"type-declarations\">Type Declarations</h5>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">TYPE</span>\n\nDevice<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> POINTER <span class=\"token keyword\">TO</span> DeviceDesc<span class=\"token punctuation\">;</span>  <span class=\"token comment\">(* Pointer to record (reference type)*)</span>\nDeviceDesc<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">RECORD</span>              <span class=\"token comment\">(* Record: Value type *)</span>\n    id<span class=\"token operator\">*</span><span class=\"token punctuation\">:</span> INTEGER<span class=\"token punctuation\">;</span>\n    Open<span class=\"token operator\">*</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">PROCEDURE</span><span class=\"token punctuation\">(</span>dev<span class=\"token punctuation\">:</span> Device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Close<span class=\"token operator\">*</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">PROCEDURE</span><span class=\"token punctuation\">(</span>dev<span class=\"token punctuation\">:</span> Device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    next<span class=\"token operator\">*</span><span class=\"token punctuation\">:</span> Device<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">(* Procedure type with signature *)</span>\nTrapHandler<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">PROCEDURE</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">:</span> INTEGER<span class=\"token punctuation\">;</span> <span class=\"token keyword\">VAR</span> res<span class=\"token punctuation\">:</span> INTEGER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nNumberType<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> REAL<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* Type alias *)</span>\n\nDeviceName<span class=\"token operator\">*</span> <span class=\"token keyword\">ARRAY</span> DeviceNameLength <span class=\"token keyword\">OF</span> CHAR<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* Array Type *)</span>\n\nData<span class=\"token operator\">*</span> POINTER <span class=\"token keyword\">TO</span> <span class=\"token keyword\">ARRAY</span> <span class=\"token keyword\">OF</span> CHAR<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* Dynamic array type *)</span></code></pre></div>\n<h5 id=\"inheritance\">Inheritance</h5>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">Task<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> POINTER <span class=\"token keyword\">TO</span> TaskDesc<span class=\"token punctuation\">;</span>\nTaskDesc<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">RECORD</span>\n    task task task\n    task task\n    proc<span class=\"token punctuation\">:</span><span class=\"token keyword\">PROCEDURE</span><span class=\"token punctuation\">(</span>me<span class=\"token punctuation\">:</span>Task<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">(* This procedure is executed in the task *)</span>\n    next<span class=\"token punctuation\">:</span> Task<span class=\"token punctuation\">;</span>              <span class=\"token comment\">(* The next task in the list of tasks *)</span>\n<span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span>\n\nPeriodicTask<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> POINTER <span class=\"token keyword\">TO</span> PeriodicTaskDesc<span class=\"token punctuation\">;</span>\nPeriodicTaskDesc<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">RECORD</span> <span class=\"token punctuation\">(</span>TaskDesc<span class=\"token punctuation\">)</span> <span class=\"token comment\">(* inherits TaskDesc *)</span>\n    priority<span class=\"token punctuation\">:</span> LONGINT<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* The priority determines the execution order *)</span>\n    interval<span class=\"token punctuation\">:</span> LONGINT<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* The task is executed every \"interval\" msecs *)</span>\n<span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Type Test</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">IF</span> task IS PeriodicTask <span class=\"token keyword\">THEN</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Type Guard (cast)</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">IF</span> task<span class=\"token punctuation\">(</span>PeriodicTask<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>priority <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token keyword\">THEN</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Type Test and Guard</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">WITH</span> task<span class=\"token punctuation\">:</span> PeriodicTask <span class=\"token keyword\">DO</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"run-time-support-for-inheritance\">Run-time Support for Inheritance</h5>\n<ul>\n<li>RTTI is supported</li>\n<li>Each type gets an unique type descriptor (<code class=\"language-text\">LONGINT</code>)</li>\n<li>The variables contain an array of up to 3 tags</li>\n<li>The tags point to the type descriptors</li>\n<li>Inheritance level is restricted to 3</li>\n</ul>\n<h4 id=\"module-loading-and-commands\">Module Loading and Commands</h4>\n<ul>\n<li>Modules are loaded on demand (first use)</li>\n<li>Statically linked modules are loaded at boot-time</li>\n<li>Exported Procedures without parameters act as commands</li>\n<li>Modification of modules needs reloading</li>\n<li>Unloading possible, if no other loaded module (static or dynamic) depends on it</li>\n<li>If a command of a not loaded module is executed the module is loaded first</li>\n</ul>\n<h4 id=\"compilation-and-linking\">Compilation and Linking</h4>\n<ul>\n<li>A module (.mod) is compiled to an executable file / object file (.arm) and a symbol file (.smb)</li>\n<li>The executable file contains a fingerprint</li>\n<li>The linker adds fingerprint to dependent object files (fix-up)</li>\n</ul>\n<h4 id=\"object-file-format\">Object File Format</h4>\n<p>Compiler flags:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Compiler.Compile -b<span class=\"token operator\">=</span>ARM --objectFile<span class=\"token operator\">=</span>Minos</code></pre></div>\n<ul>\n<li>The object file is very compact</li>\n<li>Key: Fingerprint</li>\n<li>Fix-ups → Fix-up-root (relocation table) linked list to fix-ups</li>\n<li>Downsides:\n<ul>\n<li>Module file is limited</li>\n<li>Not very maintainable</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0b4bc7d3a201b9870c40b0a2119e04a2/09e48/syscon_minos_object_file.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACK0lEQVQoz3VTS2/TQBD27+cEh3IAJJCKOHBDHJBAgOpWSpsqLWqbNI8mdhw/14/122s7zodmKhA9MNJoxrPe+b55rNa2LZqmeaJ936OqKsRxDCklXNeFZVlwXY+/KZ7nOdI0RRRFmE1nMEwTYRhCcxwH2+0WpmmyNQwDtm3D8zyUZQkC3FkWLsdjGIaJtlUoigJCCGRZhlAITCYTPDysOaYR8nq9xmq14qTzxYLZEJPD4QAS8ne7HTMgoTixpCootlwumQwBaEEQwPd9ZkS+47pcIpXSdR32+wFRGGKz2fB/wzCg61pOmGU5ZrN7Bru7u+N7GpXVNAplWTGiUi1Tp0MqL4pCLmk6nWI8HoNalOU1PF+gKnOcnZ1hPp/jRNexWCyhdZ2CUjW6tgH5TV1i2HdIkhhpVqEoFYzNBhfnF1guV8yawNeGwGodIAwFyjKDlBGDazKt4QcFHDeFZSdI0hax7DFbCIjokf3t7S1GoxHbuq5ZkyRCECroIxtbO4frl8hyBe3HyT2OXn3D0Wsdb44n+Px1A8dr4HkCTVOjqkruj67ruLq6Qp4X3BpKmGUtnr/8jmfPv+Ddh2uYdgftpz7Fi6NPePv+HMcfZxhfBzxJajrto1Lqb0/J0hp1XQ8pY5TVHqfnDk5HW1z+CiDiDlqcVDAtAdcvIKIeWd5zQpoyCSW8ubnh1aDB0EL/e/5UDtDwH6Hp06VESn4Rf1TKhOO0cyTDcOC9fFTgN7qlMj6cJdmhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Minos Object Files\"\n        title=\"Minos Object Files\"\n        src=\"/static/0b4bc7d3a201b9870c40b0a2119e04a2/f058b/syscon_minos_object_file.png\"\n        srcset=\"/static/0b4bc7d3a201b9870c40b0a2119e04a2/c26ae/syscon_minos_object_file.png 158w,\n/static/0b4bc7d3a201b9870c40b0a2119e04a2/6bdcf/syscon_minos_object_file.png 315w,\n/static/0b4bc7d3a201b9870c40b0a2119e04a2/f058b/syscon_minos_object_file.png 630w,\n/static/0b4bc7d3a201b9870c40b0a2119e04a2/40601/syscon_minos_object_file.png 945w,\n/static/0b4bc7d3a201b9870c40b0a2119e04a2/09e48/syscon_minos_object_file.png 974w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>This image is taken from the lecture slides provided by Felix Friedrich</p>\n<h4 id=\"boot-file\">Boot-file</h4>\n<ul>\n<li>Linked Modules of Kernel files (hierarchy)</li>\n<li>Predefined loading address and entry point (0x8000 for RPI2)</li>\n</ul>\n<p>Boot-Linking command in host system</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">MinosLinker.Link minimalinit.img 108000H kernel.img OFSRamVolumes SerialLog Minos  ~</code></pre></div>\n<ul>\n<li>Image header: <code class=\"language-text\">minimalinit.img</code></li>\n<li>Start address: <code class=\"language-text\">108000H</code></li>\n<li>Image file name: <code class=\"language-text\">kernel.img</code></li>\n<li>Object file names (compiled): <code class=\"language-text\">OFSRamVolumes SerialLog Minos  ~</code></li>\n</ul>\n<!-- Beginning of Slides Week 3 -->\n<h3 id=\"minos-kernel\">Minos Kernel</h3>\n<h4 id=\"system-start-up\">System Start-up</h4>\n<ul>\n<li>\n<p>Firmware (RPI2, GPU)</p>\n<ol>\n<li>Initialise HW</li>\n<li>Copy boot image to RAM</li>\n<li>Jump to boot image (initializer)</li>\n</ol>\n</li>\n<li>\n<p>Initializer</p>\n<ol>\n<li>Set <em>stack registers</em> for all processor modes</li>\n<li>Setup <em>free heap</em> and <em>module</em> list</li>\n<li>Initialise <em>MMU</em> and <em>page table</em></li>\n<li>Setup <em>interrupt handler</em> and <em>vectors</em></li>\n<li>Start <em>timer</em> and <em>enable interrupts</em></li>\n<li>Initializer UARTs, RAM disks, …</li>\n<li>Enter scheduling loop on OS</li>\n</ol>\n</li>\n</ul>\n<p>The Minos Kernel is modular:</p>\n<ul>\n<li>Minos: Command interpreter and scheduler</li>\n<li>Modules: Module loader, dynamic linker</li>\n<li>File System: RamVolumes, OFS, …</li>\n<li>Kernel: Memory management, device drivers</li>\n<li>I/O: Kernel logging, …</li>\n<li>Run-time: Memory allocation (heaps), FPU emulation, …</li>\n</ul>\n<!-- Slides Week 3 09-29 p. 84 (6) -->\n<p>…</p>\n<!-- Slides and Notes Week 4 -->\n<h4 id=\"initialisation-of-interrupts\">Initialisation of Interrupts</h4>\n<ol>\n<li>Set handlers of IRQ’s\n<ul>\n<li>Write handlers for needed interrupts</li>\n<li>Put jumps to handlers into interrupt table</li>\n</ul>\n</li>\n<li>Enable IRQ’s</li>\n</ol>\n<p>Usually Interrupts need to be configured in 3 parts:</p>\n<ul>\n<li>CPU (enable, masking…)</li>\n<li>Interrupt Controller</li>\n<li>Device</li>\n</ul>\n<p>The RPI2 has 3 memory-mapped IRQ registers (32-bit):</p>\n<ul>\n<li><em>Pending Bits</em> indicate which interrupts are pending</li>\n<li>Need to be checked in the <em>IRQ Trap Handler</em> (1st level handler)</li>\n<li>Call <em>IRQ Handler</em> (2nd level) depending on pending bits</li>\n</ul>\n<h4 id=\"task-scheduling-minos\">Task Scheduling (Minos)</h4>\n<p>3 Task types:</p>\n<ul>\n<li>High Priority (every 5 ms)</li>\n<li>Low Priority (every 20 ms)</li>\n<li>Background tasks</li>\n</ul>\n<p>Preemption:</p>\n<ul>\n<li>High priority tasks preempt low priority and background tasks</li>\n<li>Low priority tasks preempt only low priority tasks</li>\n<li>Background tasks don’t preempt any tasks</li>\n</ul>\n<p>Task Descriptors for</p>\n<ul>\n<li>Synchronous (periodic) tasks</li>\n<li>Asynchronous (background) tasks</li>\n</ul>\n<h5 id=\"stack-minos\">Stack (Minos)</h5>\n<ul>\n<li>One stack for all processes</li>\n<li>Every task needs to run to completion</li>\n<li>Preemption is possible\n<ul>\n<li>Preempting task needs to be completed before returning</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"scheduler-minos\">Scheduler (Minos)</h5>\n<p>Recursive interrupt procedure</p>\n<ul>\n<li>Prolog: Interrupts masked</li>\n<li>Scheduling: Interrupts allowed</li>\n<li>Epilogue: Interrupts masked</li>\n</ul>\n<p>Scheduler procedure must be <em>reentrant</em></p>\n<ul>\n<li>Register values on stack</li>\n<li>Private variables</li>\n</ul>\n<p>Assumptions for scheduler</p>\n<ul>\n<li>Linked list stores tasks sorted by period and priority</li>\n<li>Tasks run to completion within given period</li>\n</ul>\n<!-- End of Week 4 -->\n<!-- Beginning of Week 5 -->\n<h2 id=\"serial-communication\">Serial Communication</h2>\n<ul>\n<li>Directionally\n<ul>\n<li>Simplex</li>\n<li>Half duplex</li>\n<li>Full duplex</li>\n</ul>\n</li>\n<li>Synchrony\n<ul>\n<li>Synchronous</li>\n<li>Asynchronous</li>\n</ul>\n</li>\n</ul>\n<p>Examples:</p>\n<ul>\n<li>RS-232</li>\n<li>RS-458</li>\n<li>SPI (SSP, Microwire)</li>\n<li>I<span class=\"math math-inline\"><span class=\"katex\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">^2</annotation></semantics></math></span></span>C</li>\n<li>1-Wire</li>\n<li>USB</li>\n</ul>\n<h3 id=\"spi\">SPI</h3>\n<ul>\n<li>Very simple</li>\n<li>4 Wires:\n<ul>\n<li>SCLK: Serial bit-rate Clock</li>\n<li>MOSI: Master data Output, Slave data Input</li>\n<li>MISO: Master data Input, Slave data Output</li>\n<li>SS: Slave Select</li>\n</ul>\n</li>\n<li>Configurations:\n<ul>\n<li>Single slave mode: 1 Master, 1 Slave</li>\n<li>multiple slave mode: 1 Master, N Slaves</li>\n</ul>\n</li>\n<li>Synchronous bidirectional data transfer</li>\n<li>Data transfer initiated by master</li>\n<li>Bandwidth some KBits/s up to several MBits/s</li>\n<li>Simple implementation in software possible (bit-banging)</li>\n<li>Master and Slave have shift registers for data (in and output)\n<ul>\n<li>During communication data ‘circles around’ between the two shift registers</li>\n</ul>\n</li>\n</ul>\n<p>Communication</p>\n<ol>\n<li>Master pulls SS to low</li>\n<li>Master pushed data out of shift register</li>\n<li>Slave pushes data out of shift register at the same time</li>\n<li>Sampling happens at SCLK</li>\n<li>To finish communication master stops SCLK</li>\n</ol>\n<ul>\n<li>No acknowledgment mechanism</li>\n<li>No device interrupts</li>\n</ul>\n<h4 id=\"setup\">Setup</h4>\n<ul>\n<li>Polarity (SCLK):\n<ul>\n<li>0: Sampling happens on rising SCLK edge</li>\n<li>1: Sampling happens on falling SCLK edge</li>\n</ul>\n</li>\n<li>Phase (SCLK):\n<ul>\n<li>0: Rising SCLK edge in the middle of data</li>\n<li>1: Rising SCLK edge on beginning of data</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"uart\">UART</h3>\n<ul>\n<li>Serial transmission (least significant bit first)</li>\n<li>Configurable\n<ul>\n<li>Number of data bits: 5, 6, 7, 8</li>\n<li>Parity: odd, even, none</li>\n<li>Stop-bits: 1, 1.5, 2</li>\n<li>Transfer rate (bits per second): 75, 110, 300, …, 115200</li>\n<li>Flow control exists in some implementations</li>\n</ul>\n</li>\n</ul>\n<!-- End of Week 5 -->\n<!-- Beginning of Week 6 -->\n<h1 id=\"a2-case-study-2\">A2 (Case Study 2)</h1>\n<h2 id=\"intel-x86\">Intel x86</h2>\n<ul>\n<li>Shared Memory (for all processors)</li>\n<li>Symmetrical Multiple Processors (SMP)</li>\n</ul>\n<h3 id=\"resources-x86-compatible-hw\">Resources (x86 compatible HW)</h3>\n<p><a href=\"http://wiki.osdev.org\">osdev.org</a></p>\n<ul>\n<li>SDM: Intel® 64 and IA-32 Architectures Software Developer’s Manual (4000 p., 3 volumes)\n<ol>\n<li>Architecture</li>\n<li>Instruction Set Reference</li>\n<li>System Programming Guide</li>\n</ol>\n</li>\n<li>MP Spec: Intel Multiprocessor Specification, version 1.4 (100 p.)</li>\n<li>ACPI Spec: Advanced Configuration and Power Interface Specification (1000 p.)</li>\n<li>PCI Spec: PCI Local Bus Specification Rev. 2.2 (322 p.)</li>\n</ul>\n<h3 id=\"interrupt-system-x86\">Interrupt System (x86)</h3>\n<ul>\n<li>External IRQ’s (asynchronous)\n<ul>\n<li>I/O Devices</li>\n<li>Timer</li>\n<li>Inter-processor interrupts</li>\n</ul>\n</li>\n<li>Software IRQ’s (synchronous)\n<ul>\n<li>Traps/Syscall: special instructions</li>\n</ul>\n</li>\n<li>Processor exceptions (synchronous)\n<ul>\n<li>Faults (restartable): i.e page fault</li>\n<li>Aborts (Fatal): i.e machine check</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"apic\">APIC</h4>\n<ul>\n<li>\n<p>Each CPU has local APIC (local interrupts)</p>\n</li>\n<li>\n<p>I/O APIC for all CPU’s (external interrupts)</p>\n</li>\n<li>\n<p>Messages to processors</p>\n<ul>\n<li>Start Processor: Activation and Initialisation of individual processors</li>\n<li>Halt Processor: Deactivation of individual processors</li>\n<li>Halt Process, schedule new process: Interrupt in order to transfer control to scheduler</li>\n</ul>\n</li>\n<li>\n<p>Local timers</p>\n<ul>\n<li>Periodical interrupts</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"multiprocessor-specification\">MultiProcessor Specification</h4>\n<ul>\n<li>Standard by Intel (MP Spec 1.4)</li>\n<li>Hardware Specification\n<ul>\n<li>Memory Map</li>\n<li>APIC</li>\n<li>Interrupt Modes</li>\n</ul>\n</li>\n<li>MP Configuration Table\n<ul>\n<li>Processor, Bus, I/O APIC</li>\n<li>Table address searched via “floating pointer structure”</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"exception-numbers\">Exception Numbers</h4>\n<table>\n<thead>\n<tr>\n<th>Vector #</th>\n<th>Description</th>\n<th>Source</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>Div error</td>\n<td>div / idiv instruction</td>\n</tr>\n<tr>\n<td>1</td>\n<td>Debug</td>\n<td>Code / data reference</td>\n</tr>\n<tr>\n<td>2</td>\n<td>NMI</td>\n<td>Non maskable external IRQ</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Breakpoint</td>\n<td>int 3 instruction</td>\n</tr>\n<tr>\n<td>4 – 19</td>\n<td>Other processor exceptions</td>\n<td>E.g. page fault etc.</td>\n</tr>\n<tr>\n<td>20-31</td>\n<td>reserved</td>\n<td></td>\n</tr>\n<tr>\n<td>32-255</td>\n<td>Maskable Interrupts</td>\n<td>External Interrupts from <code class=\"language-text\">INTR</code> pin <code class=\"language-text\">INT</code> n instruction</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"configuring-apic\">Configuring APIC</h4>\n<ul>\n<li>Local Vector Table (for local interrupt sources)\n<ul>\n<li>Vector Number, Trigger Mode, Status, Interrupt Vector Mask</li>\n<li>Timer Mode (one shot / periodic)</li>\n</ul>\n</li>\n<li>Command Register: Inter Processor Interrupt with\n<ul>\n<li>vector number,</li>\n<li>delivery mode: fixed, nmi, init, startup (..)</li>\n<li>logical / physical destination (including self and broadcasts with / without self</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"pci-local-bus\">PCI Local Bus</h3>\n<ul>\n<li>Connect Peripheral Components</li>\n<li>Standardised Configuration Address Space for all PCI Devices</li>\n<li>Interrupt Routing Configuration</li>\n</ul>\n<p>Access mechanism</p>\n<ul>\n<li>PCI BIOS: offers functionality such as “find device by classcode”. Presence determined by floating data structure in BIOS ROM</li>\n<li>Addressable via in / out instructions operating on separate I/O memory address space</li>\n<li>PCI Express now Memory Mapped I/O</li>\n</ul>\n<h2 id=\"active-oberon-language\">Active Oberon Language</h2>\n<h3 id=\"locks-vs-monitors\">Locks vs. Monitors</h3>\n<ul>\n<li>Lock based\n<ul>\n<li>shared data</li>\n<li>protected from concurrent access by locks</li>\n</ul>\n</li>\n<li>Monitor based\n<ul>\n<li>locks code (methods) that access shared data</li>\n<li>No direct locking of data structures needed</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"threads-vs-active-objects\">Threads vs. Active Objects</h3>\n<ul>\n<li>Threads\n<ul>\n<li>Concurrently running code</li>\n</ul>\n</li>\n<li>Active Objects\n<ul>\n<li>Objects that contain threads</li>\n<li>Threads in form of Monitors</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"object-model-active-oberon\">Object Model (Active Oberon)</h3>\n<ul>\n<li>\n<p><code class=\"language-text\">EXCLUSIVE</code>: Protection (mutual exclusion)</p>\n<ul>\n<li><em>Methods</em> tagged <code class=\"language-text\">EXCLUSIVE</code> run under <em>mutual exclusion</em></li>\n<li>As <code class=\"language-text\">synchronized</code> in Java</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">AWAIT</code>: Synchronisation</p>\n<ul>\n<li>Wait until condition of <code class=\"language-text\">AWAIT</code> becomes true</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">ACTIVE</code>: Parallelism</p>\n<ul>\n<li>Body marked <code class=\"language-text\">ACTIVE</code> <em>executed as thread</em> for each instance</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"signal-wait-implementations\">Signal-Wait Implementations</h3>\n<ul>\n<li>Signal-and-Continue\n<ul>\n<li>Java uses this</li>\n<li>Race conditions can occur</li>\n</ul>\n</li>\n<li>Signal-and-Exit\n<ul>\n<li>Active Oberon uses this</li>\n<li>Can be achieved in Java by looping on wait condition</li>\n</ul>\n</li>\n</ul>\n<p>Active Oberon:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">Semaphore <span class=\"token operator\">=</span> <span class=\"token keyword\">OBJECT</span>\n    number <span class=\"token operator\">:=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span> LONGINT<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">PROCEDURE</span> enter<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">BEGIN</span><span class=\"token comment\">{EXCLUSIVE}</span>\n        AWAIT number <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        DEC<span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">END</span> enter<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">PROCEDURE</span> <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">BEGIN</span><span class=\"token comment\">{EXCLUSIVE}</span>\n        INC<span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">END</span> <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">END</span> Semaphore<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Equivalent Java code:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Semaphore</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> number <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>number <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// while needed!</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        number<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        number<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>number <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* notifyAll() needed if different threads\n                          evaluate different conditions */</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"monitors-in-active-oberon\">Monitors in Active Oberon</h3>\n<ul>\n<li>No <em>notify()</em> (or <em>notifyAll()</em>): Every <code class=\"language-text\">EXCLUSIVE</code> procedure triggers reevaluation of <code class=\"language-text\">AWAIT</code> when it returns</li>\n<li>Downsides of Monitors:\n<ul>\n<li>Wasting of processor time on looping on ‘locks’</li>\n<li>Ordering can not be influenced</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"active-object-system-a2\">Active Object System (A2)</h2>\n<h3 id=\"modular-kernel-structure\">Modular Kernel Structure</h3>\n<ul>\n<li>Cover: Kernel</li>\n<li>Activity Scheduler: Objects</li>\n<li>Module Loader (Memory Management): Modules, Heaps</li>\n<li>Hardware Abstraction: Machine</li>\n</ul>\n<h3 id=\"atomic-operations-hw-support\">Atomic Operations (HW Support)</h3>\n<p>The supported operations are typically a lot slower than simple read and write operations.</p>\n<h4 id=\"intel-x86-1\">Intel (x86)</h4>\n<p>From AMD64 Architecture Programmer’s Manual:</p>\n<ul>\n<li><code class=\"language-text\">CMPXCHG mem, reg</code></li>\n</ul>\n<p>“compares the value in Register A with the value in a memory location If the two values are equal,\nthe instruction copies the value in the second operand to the first operand and sets the ZF flag\nin the flag registers to 1. Otherwise it copies the value in the first operand to A register and\nclears ZF flag to 0”</p>\n<ul>\n<li>Lock Prefix</li>\n</ul>\n<p>“The lock prefix causes certain kinds of memory read-modify- write instructions to occur atomically”</p>\n<h4 id=\"arm\">ARM</h4>\n<p>From ARM Architecture Reference Manual:</p>\n<ul>\n<li><code class=\"language-text\">LDREX &lt;rd>, &lt;rn></code></li>\n</ul>\n<p>“Loads a register from memory and if the address has the shared memory attribute, mark the physical\naddress as exclusive access for the executing processor in a shared monitor”</p>\n<ul>\n<li><code class=\"language-text\">STREX &lt;rd>, &lt;rm>, &lt;rn></code></li>\n</ul>\n<p>“performs a conditional store to memory. The store only occurs if the executing processor has\nexclusive access to the memory addressed”</p>\n<h4 id=\"overview\">Overview</h4>\n<p>Some typical instructions for atomic operations and implementation examples.</p>\n<ul>\n<li>Test-And-Set (TAS)\n<ul>\n<li><code class=\"language-text\">TSL register, flag</code> (Motorola 68000)</li>\n</ul>\n</li>\n<li>Compare-And-Swap (CAS)\n<ul>\n<li><code class=\"language-text\">LOCK CMPXCHG</code> (Intel x86)</li>\n<li><code class=\"language-text\">CASA</code> (Sparc)</li>\n</ul>\n</li>\n<li>Load Linked / Store Conditional\n<ul>\n<li><code class=\"language-text\">LDREX</code> / <code class=\"language-text\">STREX</code> (ARM)</li>\n<li><code class=\"language-text\">LL</code> / <code class=\"language-text\">SC</code> (MIPS)</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>These hardware instructions are often much slower than simple read and write.\nCaches can’t be exploited (direct access to memory)!</p>\n</blockquote>\n<ul>\n<li>Compare-And-Swap is the most universal instruction</li>\n</ul>\n<h4 id=\"compare-and-swap-cas\">Compare-And-Swap (CAS)</h4>\n<p>Atomic operation implemented in processor.</p>\n<p>Compares memory location with an value. If it’s same a new (given) value is written at the\nmemory address. Returns the previous value at memory position in any case.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">CAS</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> old<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> new<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>If value <code class=\"language-text\">old</code> is at memory location of <code class=\"language-text\">a</code>: safe <code class=\"language-text\">new</code> at <code class=\"language-text\">a</code></li>\n<li>Return previous value at <code class=\"language-text\">a</code> in any case</li>\n</ul>\n<h4 id=\"implementation-of-a-spinal-using-cas\">Implementation of a spinal using CAS</h4>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token comment\">(* Initialisation *)</span>\nInit<span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span>\n    lock <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">(* Acquire Lock *)</span>\nAcquire <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> lock<span class=\"token punctuation\">:</span> word<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">repeat</span>\n        res <span class=\"token operator\">:=</span> CAS<span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">until</span> res <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">(* Release Lock *)</span>\nRelease <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> lock<span class=\"token punctuation\">:</span> word<span class=\"token punctuation\">)</span>\n    CAS<span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">(* atomicy not needed but visibility/ordering *)</span></code></pre></div>\n<!-- End of Notes Week 6 -->\n<!-- Beginning of Notes Week 7 -->\n<h3 id=\"boot-procedure-a2\">Boot Procedure (A2)</h3>\n<ul>\n<li>Start BIOS Firmware</li>\n<li>Load A2 Boot-file</li>\n<li>Initialise modules\n<ul>\n<li>Module <em>Machine</em></li>\n<li>Module <em>Heaps</em></li>\n<li>…</li>\n<li>Module <em>Objects</em>\n<ul>\n<li>Setup scheduler and self process</li>\n</ul>\n</li>\n<li>Module <em>Kernel</em>\n<ul>\n<li>Start all processors</li>\n</ul>\n</li>\n<li>…</li>\n<li>Module Boot-console\n<ul>\n<li>read configuration and execute boot commands</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>This all happens on the Boot Processor (BP)</p>\n</blockquote>\n<h4 id=\"processor-startup\">Processor Startup</h4>\n<ul>\n<li>Start processor <strong>P</strong> (Boot-processor)\n<ol>\n<li>Setup boot program (<code class=\"language-text\">Machine.InitProcessors</code>)</li>\n<li>Enter processor IDs into table (<code class=\"language-text\">Machine.InitBootPage</code>)</li>\n<li>Send <em>startup</em> message to <strong>P</strong> via APIC (<code class=\"language-text\">Machine.ParseMPConfig</code>)</li>\n<li>Wait with timeout on <em>started</em> flag by P (<code class=\"language-text\">Machine.StartProcessor</code>)</li>\n</ol>\n</li>\n<li>Boot program (For each processor)\n<ol>\n<li>Set 32-bit run-time environment (<code class=\"language-text\">Machine.EnterMP</code>)</li>\n<li>Initializer control registers, memory management, interrupt handling, APIC</li>\n<li>Set <em>started</em> flag (<code class=\"language-text\">Machine.StartMP</code>)</li>\n<li>Setup Scheduler (<code class=\"language-text\">Objects.Start</code>)</li>\n<li>Boot-processor proceeds with boot console</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"a2-activities-states\">A2 Activities States</h3>\n<ul>\n<li>Ready: ready to be scheduled</li>\n<li>Running: currently scheduled</li>\n<li>Waiting\n<ul>\n<li>Condition (<code class=\"language-text\">AWAIT</code>): waiting until condition is met</li>\n<li>Lock (<code class=\"language-text\">EXCLUSIVE</code>): waiting to enter monitor</li>\n</ul>\n</li>\n<li>Terminated: Activity finished executing</li>\n</ul>\n<blockquote>\n<p>Java doesn’t make difference between waiting on a condition or a lock.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/47e10e70429a5c8c7dd653382bb992e3/bbb77/syscon_a2_activieties_states.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.51898734177215%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAk0lEQVQI113ObQuEIBAE4P7/TwxqyaVNI65N7cVV6yDpiHs+DgMz1fVY15WIAICIjDH7vscYU0oxRhFJKZVaSYrqvJU0hDAMwziOnwcitm0LAMx8HMc8z1prpVTTNMaYats2a20IwTnX971Sqq5rAHDOee+ZeZomRJTb//L1knP+PRQRZtZaIyIRdV23LEvO+d3/Aq5t5DH9chotAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A2 Activities States\"\n        title=\"A2 Activities States\"\n        src=\"/static/47e10e70429a5c8c7dd653382bb992e3/f058b/syscon_a2_activieties_states.png\"\n        srcset=\"/static/47e10e70429a5c8c7dd653382bb992e3/c26ae/syscon_a2_activieties_states.png 158w,\n/static/47e10e70429a5c8c7dd653382bb992e3/6bdcf/syscon_a2_activieties_states.png 315w,\n/static/47e10e70429a5c8c7dd653382bb992e3/f058b/syscon_a2_activieties_states.png 630w,\n/static/47e10e70429a5c8c7dd653382bb992e3/bbb77/syscon_a2_activieties_states.png 765w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"run-time-data-structures\">Run-Time Data Structures</h3>\n<ul>\n<li>Running Array/List\n<ul>\n<li>One entry for each processor</li>\n<li>Index: id of processor</li>\n</ul>\n</li>\n<li>Object header (for each object)\n<ul>\n<li>List of conditions (for each condition)</li>\n<li>List of locks (for each monitor)</li>\n</ul>\n</li>\n<li>Ready Queues/Heap\n<ul>\n<li>Idle</li>\n<li>Low</li>\n<li>Medium</li>\n<li>High</li>\n<li>Garbage Collector (GC)</li>\n<li>Real-time (RT)</li>\n</ul>\n</li>\n<li>Interrupt Array (first level IRQ’s)\n<ul>\n<li>Index: IRQ number</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"stack-management\">Stack Management</h3>\n<ul>\n<li>Virtual addressing</li>\n<li>Allocation in page units</li>\n<li>Page fault for detecting stack overflow</li>\n<li>Deallocate process stack via garbage collector (in process finalizer)</li>\n<li>Life cycle:\n<ul>\n<li>CreateProcess: Allocate first frame</li>\n<li>Page fault: Allocate another frame</li>\n<li>Finalize: Deallocate all frames</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>Active Oberon has one shared memory for all processes!</p>\n</blockquote>\n<ul>\n<li>One Heap for all processes (no heavy-weight processes)</li>\n<li>Each process has own stack</li>\n<li>All processes share same address space</li>\n<li>8’000 processes can be allocated\n<ul>\n<li>4 GB address space</li>\n<li>4 kB pages</li>\n<li>1024 pages per process</li>\n<li>↳ ~ 8’000 processes</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"context-switch\">Context Switch</h3>\n<ul>\n<li>Synchronous\n<ul>\n<li>Explicit\n<ul>\n<li>A process terminates</li>\n<li><code class=\"language-text\">Yield</code></li>\n</ul>\n</li>\n<li>Implicit\n<ul>\n<li>Mutual exclusion</li>\n<li><code class=\"language-text\">AWAIT</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Asynchronous\n<ul>\n<li>Preemption\n<ul>\n<li>Priority handling</li>\n<li>Time-slicing</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"coroutines-synchronous\">Coroutines (Synchronous)</h4>\n<ul>\n<li>Synchronous context switch</li>\n<li>Context switch:\n<ul>\n<li>Replace <em>SP</em> and <em>FP</em> of old process with <em>SP</em> and <em>FP</em> of new process</li>\n<li><em>PC</em> needs also to be adjusted</li>\n</ul>\n</li>\n<li>Stack can be used to identify process</li>\n</ul>\n<h4 id=\"asynchronous-context-switch\">Asynchronous Context Switch</h4>\n<ul>\n<li>Needs to save much more than for a synchronous context switch</li>\n<li>Save <em>all registers</em> (copy state)</li>\n</ul>\n<h3 id=\"synchronisation\">Synchronisation</h3>\n<h4 id=\"object-locking\">Object Locking</h4>\n<ul>\n<li>\n<p>Object descriptors (added by system): Object with mutual exclusion contain additional fields</p>\n<ul>\n<li><code class=\"language-text\">headerLock: BOOLEAN;</code></li>\n<li><code class=\"language-text\">lockedBy: Process;</code></li>\n<li><code class=\"language-text\">awaitingLock: ProcessQueue;</code></li>\n<li><code class=\"language-text\">awaitingCondition: ProcessQueue;</code></li>\n</ul>\n</li>\n<li>\n<p>Locking (Procedure <code class=\"language-text\">Lock</code>)</p>\n<ul>\n<li>Try to acquire object\n<ul>\n<li>when we have it, we can change the data structure</li>\n<li>if we don’t have it (we need to give up control)\n<ul>\n<li>Synchronous switching to an other process</li>\n<li><code class=\"language-text\">Select</code> and <code class=\"language-text\">SwitchTo</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Unlocking (Procedure <code class=\"language-text\">Unlock</code>)</p>\n<ul>\n<li>When giving up a lock all conditions need to be evaluated again (signal-and-exit)</li>\n<li>Otherwise the opposite of locking</li>\n</ul>\n</li>\n<li>\n<p>Wait Conditions (<code class=\"language-text\">AWAIT</code>)</p>\n<ul>\n<li>Internally boxed into a procedure (<code class=\"language-text\">PROCEDURE $Condition(fp: ADDRESS): BOOLEAN;</code>)</li>\n<li>Stack frame is needed in condition: <em>FP</em></li>\n<li><code class=\"language-text\">AWAIT</code> code: put condition on await queue</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>Side-effects in <code class=\"language-text\">AWAIT</code> conditions are dangerous!</p>\n</blockquote>\n<h4 id=\"priority-inversion\">Priority Inversion</h4>\n<p>Example:</p>\n<ul>\n<li>3 processes, 1 shared resource\n<ul>\n<li>P1: low</li>\n<li>P2: high</li>\n<li>P3: medium</li>\n<li>R: shared resource</li>\n</ul>\n</li>\n<li>P1 locks R</li>\n<li>P2 tries to lock R (needs to wait)</li>\n<li>P3 preempts P1\n<ul>\n<li>P1 can’t release R</li>\n<li>P2 can’t continue until P1 releases R</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d845d827bf9f891315cc134292288e79/6d2da/syscon_priority_inversion.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVQoz5VS2W6DQAzk/3+sVapIeW0qtWkDJBzh2PueCnMoykPUWhrGZu1Z25DhwVKMsMOIFMIcJyBhQXqIF8x5iZCN40iOcw4+BDhj0b9/wClJ6SkGpBSIkSKw+PRuQQwe1loSzpRSJBhCIMQY4WNE20vUnULTKeK2VzhfOcpakL+eVTeFgRmqow4ZY+REEptFjTFoO4Gm12h7PfOgcWkkCUz+dtYpDNzAO0fryKZnxyxOJcdnznAbDaxzNMbfbZ6QRhZCwNhAt1zqHlI7aK0J3nvarXP+CdwGEry/x1pNHIInsfuvt+Jpn9MO75O0MrOgD4g+4j+2/TYxRVzlFTnP8TP8oBAFcpbj2ByxO++wL/Y4XA54/X7B7vyGr+GEUpQoeEGY6ipZbd1Th8IJMMvAHd94NCNqUaORDVrZouIVxYMZwO2ct2KqXwV/AaHWC5pom1aQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Priority Inversion\"\n        title=\"Priority Inversion\"\n        src=\"/static/d845d827bf9f891315cc134292288e79/f058b/syscon_priority_inversion.png\"\n        srcset=\"/static/d845d827bf9f891315cc134292288e79/c26ae/syscon_priority_inversion.png 158w,\n/static/d845d827bf9f891315cc134292288e79/6bdcf/syscon_priority_inversion.png 315w,\n/static/d845d827bf9f891315cc134292288e79/f058b/syscon_priority_inversion.png 630w,\n/static/d845d827bf9f891315cc134292288e79/6d2da/syscon_priority_inversion.png 936w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>This image is taken from the lecture slides provided by Felix Friedrich</p>\n<h4 id=\"priority-inheritance\">Priority Inheritance</h4>\n<ul>\n<li>One possibility to cope with priority inversion</li>\n<li>The priority of each process holding a lock to a resource is increased to the highest priority of all waiting processes (for the lock)</li>\n<li>Need to walk the graph of locks and processes</li>\n</ul>\n<!-- End of Notes Week 7 -->\n<!-- Beginning of Notes Week 8 -->\n<h3 id=\"lock-free-programming\">Lock-Free Programming</h3>\n<p>Problems with Locks</p>\n<ul>\n<li>Deadlocks</li>\n<li>Livelocks</li>\n<li>Starvation</li>\n</ul>\n<p>Different Goals</p>\n<ul>\n<li>Parallelism</li>\n<li>Progress Guarantees</li>\n<li>Reentrancy</li>\n<li>Granularity</li>\n<li>Fault Tolerance</li>\n</ul>\n<p>Definition of Lock-Freedom</p>\n<blockquote>\n<p>At least one algorithm (process, thread) makes progress, even if others run concurrently, fail or get suspended.</p>\n</blockquote>\n<ul>\n<li>Starvation can still happen</li>\n</ul>\n<p>Definition of Wait-Freedom</p>\n<blockquote>\n<p>Each algorithm makes eventually progress.</p>\n</blockquote>\n<ul>\n<li>Implies freedom from starvation</li>\n</ul>\n<p>Progress Conditions:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Blocking</th>\n<th>Non-Blocking</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Someone make progress</td>\n<td>Deadlock-free</td>\n<td>Lock-free</td>\n</tr>\n<tr>\n<td>Everyone makes progress</td>\n<td>Starvation-free</td>\n<td>Wait-free</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Lock-free programming basically makes loop around CAS</li>\n<li>Overflows (i.e INTEGER) is critical</li>\n</ul>\n<h4 id=\"a2\">A2</h4>\n<h5 id=\"goals\">Goals</h5>\n<ul>\n<li>Lock Freedom\n<ul>\n<li>Progress Guarantees</li>\n<li>Reentrant Algorithms</li>\n</ul>\n</li>\n<li>Portability\n<ul>\n<li>Hardware Independence</li>\n<li>Simplicity, Maintenance</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"guiding-principles\">Guiding Principles</h5>\n<ul>\n<li>Use <em>implicit cooperative multitasking</em></li>\n<li>no virtual memory</li>\n<li>possible optmizations are limited</li>\n<li>Co-design of OS, Compiler and Programming Language</li>\n</ul>\n<h5 id=\"lock-free-kernel\">Lock-Free Kernel</h5>\n<ul>\n<li>Needs lock-free queue</li>\n<li>Compare-And-Swap (CAS) is implemented <em>wait-free</em> in hardware</li>\n</ul>\n<h5 id=\"memory-model-for-lock-free-active-oberon\">Memory Model for Lock-Free Active Oberon</h5>\n<ol>\n<li>Data shared between two or more activities at the same time has to be either\n<ul>\n<li>protected by <code class=\"language-text\">EXCLUSIVE</code> blocks or</li>\n<li>read or modified using the <em>compare-and-swap</em> operation</li>\n</ul>\n</li>\n<li>Changed shared data is visible to other activities after\n<ul>\n<li>leaving an <code class=\"language-text\">EXCLUSIVE</code> block or</li>\n<li>executing a <em>compare-and-swap</em> operation</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li><code class=\"language-text\">CAS</code> is an operation in the programming language</li>\n</ul>\n<p>Declaration:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">PROCEDURE</span> CAS<span class=\"token punctuation\">(</span>variable<span class=\"token punctuation\">,</span> old<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span><span class=\"token punctuation\">:</span> BaseType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> BaseType</code></pre></div>\n<ul>\n<li>Performance of <code class=\"language-text\">CAS</code>\n<ul>\n<li>On the HW level <code class=\"language-text\">CAS</code> triggers a memory barrier</li>\n<li>Performance suffers with increasing number of contenders (contention)</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"aba-problem\">ABA Problem</h4>\n<p>The <a href=\"https://en.wikipedia.org/wiki/ABA_problem\">ABA Problem</a> occurs when one thread\nfails to recognise that a memory location was\nmodified temporarily by another thread and therefore erroneously assumes\nthat the overall state has not been changed.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a5db4379dc4f5130d1c23bcd68e2d1eb/ee3fb/syscon_aba_problem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVQY032Q626DMAyF8/5vN2mMSlunUkDjHtIUkpA4Z4opVfdnliLbn07sIwspJeq6RspEhBTOObRty1wpxSyEgHEc0XU9sxgj65qmYd73PaZpghjHAUVRoGtbaK35s7UG12uBqioxz5JZJIJzFs5abM4xS/osy3A+fyHPc5RlCcFiAH43x5uPSIweLVGEDxHORxwS7z3W1UAvBrfbHcYYiNV6lI3G6TIjhH2qDwR5s/j4lhik2c+wBa4TW4x/nCFC3TecLgqz3piJw82rsyPSAqK/3Ht6alMORNg8cU69qBqFt/dP/AwLemmfLl8XpPp4/xlIA38Bph7STy2XQKoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ABA Problem\"\n        title=\"ABA Problem\"\n        src=\"/static/a5db4379dc4f5130d1c23bcd68e2d1eb/f058b/syscon_aba_problem.png\"\n        srcset=\"/static/a5db4379dc4f5130d1c23bcd68e2d1eb/c26ae/syscon_aba_problem.png 158w,\n/static/a5db4379dc4f5130d1c23bcd68e2d1eb/6bdcf/syscon_aba_problem.png 315w,\n/static/a5db4379dc4f5130d1c23bcd68e2d1eb/f058b/syscon_aba_problem.png 630w,\n/static/a5db4379dc4f5130d1c23bcd68e2d1eb/40601/syscon_aba_problem.png 945w,\n/static/a5db4379dc4f5130d1c23bcd68e2d1eb/ee3fb/syscon_aba_problem.png 1144w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>This image is taken from the lecture slides provided by Felix Friedrich</p>\n<ul>\n<li>The ABA Problem makes it difficult to reuse nodes in a stack structure\n<ul>\n<li>Possible to allocate always new memory, but it’s expensive</li>\n</ul>\n</li>\n<li>Solution: hazard pointers</li>\n</ul>\n<h5 id=\"hazard-pointers\">Hazard Pointers</h5>\n<ul>\n<li>ABA Problem because of reuse of pointers\n<ul>\n<li>Pointer <em>P</em> that has been read by one thread <em>X</em> but not yet written by same thread</li>\n<li>Pointer <em>P</em> is written by other thread <em>Y</em> between reading and writing of first thread <em>X</em></li>\n</ul>\n</li>\n<li>[Hazard pointers](<a href=\"https://en.wikipedia.org/wiki/Hazard_pointer\">https://en.wikipedia.org/wiki/Hazard_pointer</a>:\n<ul>\n<li>Each lock-free data structure has an array (hazard array) of the size of number of threads (n=number of threads)</li>\n<li>Before <em>X</em> reads <em>P</em>, it marks it hazardous in the hazard array of data structure (e.g. the stack)</li>\n<li>When finished (after the <code class=\"language-text\">CAS</code>), process <em>X</em> removes <em>P</em> from the hazard array</li>\n<li>Before a process <em>Y</em> tries to reuse <em>P</em>, it checks all entries of the hazard array</li>\n</ul>\n</li>\n<li>Hazard pointers don’t solve problem when several pointers need to be changed at same time\n<ul>\n<li>i.e Enqueue/Dequeue</li>\n<li>Solution: use <em>sentinel</em>\n<ul>\n<li>Notion of helping other threads</li>\n<li>Employ Hazard pointers</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<!-- See Notes Week 8 p. 3 45:00 -->\n<h3 id=\"cooperative-multitasking-implicit\">Cooperative Multitasking (implicit)</h3>\n<ul>\n<li>Compiler automatically inserts code for cooperative multitasking (implicit)</li>\n<li>Each process has a quantum</li>\n</ul>\n<p>At regular intervals, the compiler inserts code to decrease the quantum and calls the scheduler if necessary</p>\n<div class=\"gatsby-highlight\" data-language=\"nasm\"><pre class=\"language-nasm\"><code class=\"language-nasm\">   sub    <span class=\"token operator\">[</span><span class=\"token register variable\">rcx</span> <span class=\"token operator\">+</span> <span class=\"token number\">88</span><span class=\"token operator\">]</span>, <span class=\"token number\">10</span>   <span class=\"token comment\">; decrement quantum by 10</span>\n   jge    skip             <span class=\"token comment\">; check if it is negative (jump if greater)</span>\n   call   Switch           <span class=\"token comment\">; perform task switch</span>\n<span class=\"token label function\">skip:</span>\n   <span class=\"token comment\">; ...</span></code></pre></div>\n<ul>\n<li>Uncooperative block (<code class=\"language-text\">UNCOOPERATIVE</code>): Guarantee that no scheduling happens\n<ul>\n<li>Not like a <em>lock</em> different processors can execute the code in parallel</li>\n<li>like disabling interrupts</li>\n</ul>\n</li>\n<li>Cons\n<ul>\n<li>Small overhead of inserted code</li>\n<li>Sacrifice register (<code class=\"language-text\">rcx</code>)</li>\n</ul>\n</li>\n<li>Guarantees\n<ul>\n<li>Max number of parallel execution of uncooperative code is number of processors</li>\n<li>Hazard pointer can be associated with processor (instead of processes)</li>\n<li>Search time constant: thread-local storage → processor local storage</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"interrupts\">Interrupts</h4>\n<ul>\n<li>Interrupt handlers are modeled as <em>virtual</em> processors</li>\n<li>M = # of physical processors + # of potentially concurrent interrupts</li>\n</ul>\n<!-- End of Week 8 -->\n<!-- Beginning of Week 9 -->\n<h4 id=\"queue-data-structures\">Queue Data Structures</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9e82bb0be8d48f7c48e99c77d8be39c/91b29/syscon_queue_data_structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz42RW2/TQBCF/f9/CE+oTzxA1UKgqeKSQGgSokDBENuxvbZjx7ddX5J8KBuQSAuUkUbn7Mzs2ZlZo44TKtejtF0qz6d0XHZNy8H2+/2J/4r9y4z1hyl+r0/xbclj9piYFszuLOLRGOkF7NoWGQikH9BJyVbVmisR6dx/dZjczvAu31B8t7VAcDXAf9VH+oIm2eA8O9cTtHlxIvhwFT8Ft0pRx2vdYZ2kdGVFk27YSkUnFbuuOxn574JHNLyLHtaTp6xevCQ0h4hrk2QyPxbt9vrl3y/eH/v+xxmF7ZIu7sisJaXrkS9dmij+436WfkGa15qHieSrmz3coeWXLJyCA36yc1axQrU7pOqQdXdE1ZFXLZab4wSljrui5IuTkZWNPleqo262GL3RirNLi3PTYXArGH2MeDsLtZsTwc00ZLyI6Y8DbmYhg4lgOI+4eu9jTg91Ea/feTy/thnOQ4xD66uwxI8rVmGlUSSSYC3xogqxljr2ebnRHQWxJEyUzh14lB65ExSa/wBzAftLKtJ9AgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Queue Data Structures\"\n        title=\"Queue Data Structures\"\n        src=\"/static/e9e82bb0be8d48f7c48e99c77d8be39c/f058b/syscon_queue_data_structure.png\"\n        srcset=\"/static/e9e82bb0be8d48f7c48e99c77d8be39c/c26ae/syscon_queue_data_structure.png 158w,\n/static/e9e82bb0be8d48f7c48e99c77d8be39c/6bdcf/syscon_queue_data_structure.png 315w,\n/static/e9e82bb0be8d48f7c48e99c77d8be39c/f058b/syscon_queue_data_structure.png 630w,\n/static/e9e82bb0be8d48f7c48e99c77d8be39c/40601/syscon_queue_data_structure.png 945w,\n/static/e9e82bb0be8d48f7c48e99c77d8be39c/91b29/syscon_queue_data_structure.png 983w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>This image is taken from the lecture slides provided by Felix Friedrich</p>\n<ul>\n<li>Hazard Pointers: in use (writing)</li>\n<li>Pool: Reuse nodes that are not used anymore</li>\n<li>Lock-free but not wait-free (starvation possible)</li>\n<li>if not possible to en-/dequeue: help other threads (processors)</li>\n</ul>\n<h5 id=\"scheduling-activities\">Scheduling (Activities)</h5>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">TYPE</span> Activity<span class=\"token operator\">*</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">OBJECT</span> <span class=\"token comment\">{DISPOSABLE}</span> <span class=\"token punctuation\">(</span>Queues<span class=\"token punctuation\">.</span>Item<span class=\"token punctuation\">)</span> <span class=\"token comment\">(* Queues.Item accessed via activity register *)</span>\n<span class=\"token keyword\">VAR</span>\n    <span class=\"token comment\">(* access to current processor *)</span>\n    <span class=\"token comment\">(* stack management *)</span>\n    <span class=\"token comment\">(* quantum and scheduling *)</span>\n    <span class=\"token comment\">(* active object *)</span>\n<span class=\"token keyword\">END</span> Activity<span class=\"token punctuation\">;</span></code></pre></div>\n<h5 id=\"task-switch-finalizer\">Task Switch Finalizer</h5>\n<p>Finest granular protection makes <strong>races</strong> possible that did not occur previously:</p>\n<p>Need to pass information to the new thread.</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">current <span class=\"token operator\">:=</span> GetCurrentTask<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nnext <span class=\"token operator\">:=</span> Dequeue<span class=\"token punctuation\">(</span>readyqueue<span class=\"token punctuation\">)</span>\nEnqueue<span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">,</span> readyqueue<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">(* Here an other thread can dequeue and run (on the stack of)\n   the currently executing thread! *)</span>\nSwitchTo<span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>When switching to new thread\n<ul>\n<li>Enqueue runs on new thread</li>\n<li>Call finalizer of previous thread</li>\n</ul>\n</li>\n</ul>\n<p>Solution with finalizer:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">SwitchTo <span class=\"token punctuation\">(</span>nextActivity<span class=\"token punctuation\">,</span> Enqueue<span class=\"token punctuation\">,</span>  <span class=\"token comment\">(* Enqueue runs on new thread *)</span>\n          ADDRESS <span class=\"token keyword\">OF</span> readyQueue<span class=\"token punctuation\">[</span>currentActivity<span class=\"token punctuation\">.</span>priority<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nFinalizeSwitch<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* Calls finalizer of previous thread *)</span></code></pre></div>\n<h4 id=\"stack-management-1\">Stack Management</h4>\n<ul>\n<li>Stacks organized as Heap Blocks</li>\n<li>Stack check instrumented at beginning of procedure</li>\n<li>Stack expansion is possible</li>\n<li>Possibilities to expand stack:\n<ol>\n<li>Allocate more memory for stack, copy old stack to beginning of new (pointers to stack need to be updated <code class=\"language-text\">VAR</code> parameters)</li>\n<li>Manage stack in a linked list, link to new portion of stack from the old one: <code class=\"language-text\">ReturnToStackSegment</code> function needed to go back to previous stack segment</li>\n</ol>\n</li>\n</ul>\n<h5 id=\"interrupts-1\">Interrupts</h5>\n<ul>\n<li>First Level IRQ by non-portable CPU module</li>\n<li>Second level IRQ handling with activities</li>\n</ul>\n<p>Wait for interrupt:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">Interrupts<span class=\"token punctuation\">.</span>Await<span class=\"token punctuation\">(</span><span class=\"token keyword\">interrupt</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>First level IRQ code affecting scheduler queues runs on a virtual processor</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">PROCEDURE</span> Handle <span class=\"token punctuation\">(</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">:</span> SIZE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">BEGIN</span> <span class=\"token comment\">{UNCOOPERATIVE, UNCHECKED}</span>\n    <span class=\"token keyword\">IF</span> previousHandlers<span class=\"token punctuation\">[</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">]</span> # <span class=\"token keyword\">NIL</span> <span class=\"token keyword\">THEN</span>\n        previousHandlers<span class=\"token punctuation\">[</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span>\n    Activities<span class=\"token punctuation\">.</span>CallVirtual<span class=\"token punctuation\">(</span>NotifyNext<span class=\"token punctuation\">,</span>\n                           ADDRESS <span class=\"token keyword\">OF</span> awaitingQueues<span class=\"token punctuation\">[</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                           processors<span class=\"token punctuation\">[</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span> Handle<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Very powerful to write IRQ handlers in to levels</li>\n<li>Possible with cooperative multitasking</li>\n</ul>\n<h5 id=\"lock-free-memory-management\">Lock-Free Memory Management</h5>\n<ul>\n<li>Allocation/Deallocation by lock-free algorithms</li>\n<li>Buddy system: old approach but simple when returning blocks and merging them in free memory</li>\n<li>Mark-and-sweep\n<ol>\n<li>Traverse heap and mark used blocks</li>\n<li>Remove all unmarked blocks</li>\n</ol>\n</li>\n<li>Multiple garbage collectors can run in parallel</li>\n<li>Precise: doesn’t delete used blocks by accident (can happen in GC with heuristics)</li>\n<li>Optional</li>\n<li>Incremental: Possible to run on a subset all blocks (on different parts of heap)</li>\n<li>Concurrent: GC can run in concurrency of a mutating thread</li>\n<li>Parallel: Several instances of the GC can run at once</li>\n</ul>\n<p>Data Structures:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Global</th>\n<th>Per Object</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Mark Bit</td>\n<td>Cycle Count</td>\n<td>Cycle Count</td>\n</tr>\n<tr>\n<td>Marklist</td>\n<td>Marked First</td>\n<td>Next Marked</td>\n</tr>\n<tr>\n<td>Watchlist</td>\n<td>Watched First</td>\n<td>Next Watched</td>\n</tr>\n<tr>\n<td>Root Set</td>\n<td>Global References</td>\n<td>Local Refcount</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Cycle Count: used to mark visited objects</li>\n<li>Mark List: all objects that were marked previously</li>\n<li>Watch List: all candidates that could be garbage collected</li>\n<li>Root Set: where to start to find all reachable object</li>\n</ul>\n<h3 id=\"portability\">Portability</h3>\n<ul>\n<li>Lock-free A2 kernel written exclusively in a high-level language</li>\n<li>No timer interrupt required (cooperative multitasking): scheduler hardware independent</li>\n<li>No virtual memory\n<ul>\n<li>no separate address spaces</li>\n<li>everything runs in user mode, all the time</li>\n</ul>\n</li>\n<li>Hardware-dependent functions (CAS) are pushed into the language</li>\n<li>Almost completely portable:\n<ul>\n<li>Some minimal stub written in assembly code to initialize memory mappings and initialize all processors</li>\n</ul>\n</li>\n</ul>\n<!-- End of Notes Week 9 -->\n<!-- Beginning of Notes Week 10 -->\n<h1 id=\"oberon-risc-case-study-3\">Oberon RISC (Case Study 3)</h1>\n<p><a href=\"http://www.projectoberon.com/\">Project Oberon</a></p>\n<ul>\n<li>RISC architecture</li>\n<li>Oberon OS</li>\n<li>Motivation: Build system from scratch</li>\n<li>Understanding a big amount of details</li>\n<li>Commercial systems are far from perfect</li>\n<li>Need good tools for programming</li>\n<li>Competence for building from Scratch: HW, application, how it really works</li>\n<li>‘lean systems’ approach</li>\n<li>Build from scratch\n<ul>\n<li>reduce complexity: no ‘baggage’</li>\n<li>choices of different implementation</li>\n<li>design based only on problem domain and experience</li>\n<li>less surprises!</li>\n<li>flexible solutions</li>\n<li>more than customer needs</li>\n<li>competitive advantages</li>\n</ul>\n</li>\n<li>Why not build from scratch\n<ul>\n<li>re-inventing the wheel</li>\n<li>fundamental knowledge required</li>\n<li>more actual work (the first time)</li>\n<li>restricted component choices</li>\n<li>not for short-term!</li>\n<li>team work: communication!</li>\n</ul>\n</li>\n<li>Configurable Hardware\n<ul>\n<li>PAL’s / GAL’s / CPLD’s</li>\n<li>LUT and interconnect</li>\n<li>Current: FPGA</li>\n<li>loadable configuration (not like ASIC/VLSI)</li>\n</ul>\n</li>\n<li>Introduction to HDL:\n<ul>\n<li>Simulation / Synthesis</li>\n<li>Verilog / VHDL</li>\n<li>Developed at ETH: Lola, ActiveCells</li>\n<li>Very different from Programming Languages</li>\n<li>Things happen in parallel (not serial)!</li>\n<li>Very difficult for high frequencies</li>\n</ul>\n</li>\n<li>RISC architecture (overview)\n<ul>\n<li><a href=\"https://www.inf.ethz.ch/personal/wirth/FPGA-relatedWork/RISC-Arch.pdf\">Documentation</a></li>\n<li>Developed by N. Wirth</li>\n<li>Used for book “Compiler Construction” by N. Wirth</li>\n<li>RISC vs. CISC</li>\n<li>Harward vs. Von Neumann</li>\n<li>Registers vs. Stack Machine</li>\n<li>FPU</li>\n<li>ALU</li>\n<li>Shifter (Barrel-Shifter)</li>\n<li>Implemented in Verilog</li>\n<li>3 kinds of instructions\n- arithmetic/logic\n- load/store\n- floating-point</li>\n<li>RISC processor executes SW</li>\n<li>RISC0:\n<ul>\n<li>Memory addressed as words</li>\n</ul>\n</li>\n<li>RISC5:\n<ul>\n<li>Memory can be addressed as bytes</li>\n<li>Adds external static RAM</li>\n<li>FPU</li>\n<li>SPI, PS/2, GPIO, RS-233, 1 ms timer</li>\n</ul>\n</li>\n<li>Top of stack: -64</li>\n<li>Flags:\n<ul>\n<li>Not equal</li>\n<li>Zero</li>\n<li>Carry/Borrow</li>\n<li>Overflow</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<!-- End of Notes Week 10 -->\n<!-- Beginning of Notes Week 11 -->\n<ul>\n<li>Co-design: OS/HW/Compiler</li>\n<li>Minimalistic</li>\n<li>Best practices from CS</li>\n<li>Architecture/Features\n<ul>\n<li>Fast file system, module loader, garbage collector</li>\n<li>High-level, type-save language</li>\n<li>files</li>\n<li><code class=\"language-text\">Module.Command[params]</code> execution from any visual text</li>\n<li>self hosted, small (~200kB)</li>\n</ul>\n</li>\n<li>User Interface\n<ul>\n<li>Mouse oriented, three buttons, “interclicking”</li>\n</ul>\n</li>\n<li>Oberon Core System\n<ul>\n<li>Inner/Outer core</li>\n<li>File system: FileDir, File</li>\n<li>Networking</li>\n<li>Outer core: input, viewers, fonts, text, …</li>\n<li>Compiler: recursive descent, single pass</li>\n<li>RS-232, SCC, Net</li>\n<li>no memory protection</li>\n<li>possible to draw over other windows</li>\n<li>no auto save</li>\n</ul>\n</li>\n<li>Boot loader\n<ul>\n<li>loads boot file (inner core) form SD-card (or serial port)</li>\n</ul>\n</li>\n<li>Simple to build own tools build on Oberon System</li>\n<li><a href=\"https://github.com/pdewacht/oberon-risc-emu\">RISC emulator</a> available</li>\n</ul>\n<!-- End of Notes Week 11 -->\n<!-- Beginning of Notes Week 12 -->\n<h1 id=\"active-cells-case-study-4\">Active Cells (Case Study 4)</h1>\n<ul>\n<li>\n<p>Custom design of Multi-Processor System</p>\n<ul>\n<li>Cores</li>\n<li>Caches</li>\n<li>Bus</li>\n<li>Memory</li>\n</ul>\n</li>\n<li>\n<p>Each process owns it’s core</p>\n<ul>\n<li>Scheduling unnecessary</li>\n<li>Caches unnecessary</li>\n<li>some restrictions / some improvements</li>\n</ul>\n</li>\n<li>\n<p>Tiny Register Machines (TRM)</p>\n<ul>\n<li>TRM interconnects</li>\n<li>SW/HW Co-design</li>\n<li>Active Cells Tool-chain</li>\n</ul>\n</li>\n<li>\n<p>Multi-core Systems Challenges</p>\n<ul>\n<li>Cache coherence</li>\n<li>Shared memory communication bottleneck</li>\n<li>Thread synchronization overhead</li>\n<li>Difficult to predict behaviour and timing</li>\n<li>Hard to scale</li>\n<li><a href=\"https://de.wikipedia.org/wiki/Partitioned_Global_Address_Space\">Partitioned Global Address Space</a></li>\n</ul>\n</li>\n<li>\n<p>Operating System Challenges</p>\n<ul>\n<li>Processor Time Sharing\n<ul>\n<li>Interrupts</li>\n<li>Context Switches</li>\n<li>Thread Synchronisation</li>\n</ul>\n</li>\n<li>Memory Sharing\n<ul>\n<li>Inter-process: Paging</li>\n<li>Intra-process, Inter-Thread: Monitors</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Project Supercomputer in the Pocket</p>\n<ul>\n<li>Focus: Streaming Applications (i.e ECG)</li>\n<li>Stream Parallelism (pipelining)</li>\n<li>Task parallelism / data parallelism</li>\n</ul>\n</li>\n<li>\n<p>On-chip distributed system</p>\n<ul>\n<li>Replace shared memory by local memory\n<ul>\n<li>Message passing for interaction between processes</li>\n</ul>\n</li>\n<li>Separate processor for each process\n<ul>\n<li>Very simple processors</li>\n<li>No scheduling, no interrupts</li>\n<li>Application-aware processors</li>\n</ul>\n</li>\n<li>Minimal operating system</li>\n<li>Conceptually no memory bottleneck</li>\n<li>Higher reliability and predictability by design</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"tiny-register-machine-trm\">Tiny Register Machine (TRM)</h2>\n<ul>\n<li>Extremely simple processor on FPGA</li>\n<li>Hardware architecture</li>\n<li>Two-stage pipeline</li>\n<li>Each TRM contains\n<ul>\n<li>ALU and shifter</li>\n<li>32-bit operands and results stored in a bank of 2 * 8 registers</li>\n<li>Local data memory: d * 512 words of 32 bits</li>\n<li>Local program memory: i * 1024 instructions with 32 bits</li>\n<li>7 general purpose registers</li>\n<li>Register <em>H</em> for storing the high 32 bits of a product</li>\n<li>4 conditional registers: <em>C</em>, <em>N</em>, <em>V</em>, <em>Z</em></li>\n<li>no chaches</li>\n</ul>\n</li>\n</ul>\n<p>TRM Machine Language</p>\n<ul>\n<li>Machine language: binary representation of instructions</li>\n<li>18-bit instructions</li>\n<li>Three instruction types:\n<ol>\n<li>Type a: arithmetical and logical operations</li>\n<li>Type b: load and store instructions</li>\n<li>Type c: branch instructions (for jumping)</li>\n</ol>\n</li>\n<li>Instruction Encoding: Offset and Immediate values have restricted width\n<ul>\n<li>Long jumps constructed from chains</li>\n<li>Immediate store/load with shifts</li>\n</ul>\n</li>\n<li>Variants of TRMs\n<ul>\n<li>FTRM: includes FPU</li>\n<li>VTRM: includes vector processing unit\n<ul>\n<li>8 x 8-words registers</li>\n<li>available with/without FPU</li>\n</ul>\n</li>\n<li>TRM with SW configurable instruction width</li>\n</ul>\n</li>\n<li>First Experiment: TRM12\n<ul>\n<li>Message passing architecture</li>\n<li>Bus based on chip interconnect</li>\n<li>Not scalable</li>\n</ul>\n</li>\n<li>Second Experiment: Ring of 12 TRMs\n<ul>\n<li>TRM ↔ Adapter ↔ Ring</li>\n<li>Not scalable</li>\n<li>Large delays</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"active-cells\">Active Cells</h2>\n<ul>\n<li>Computing model, programming language</li>\n<li>Compiler, synthesizer, hardware library, simulator</li>\n<li>Programmable HW (FPGA)</li>\n<li>One tool-chain for SW and HW</li>\n<li>Consequences\n<ul>\n<li>No global memory</li>\n<li>No processor sharing</li>\n<li>No peculiarities of specific processor</li>\n<li>No predefined topology (NoC)</li>\n<li>No interrupts</li>\n<li>No operation system</li>\n</ul>\n</li>\n<li>Computation units: <em>Cells</em></li>\n<li>Different parallelism levels:\n<ul>\n<li>Communication Structure (Pipelining, Parallel Execution)</li>\n<li>Cell Capabilities (Vector Computing, Simultaneous Execution)</li>\n</ul>\n</li>\n<li>Inspired by: Kahn Process Networks, Dataflow Programming, CSP</li>\n<li>Active Cell Component\n<ul>\n<li>Active Cell\n<ul>\n<li>Object with private state space</li>\n<li>Integrated control thread(s)</li>\n<li>Connected via channels</li>\n</ul>\n</li>\n<li>Cell Net\n<ul>\n<li>Network of communication cells</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Active Cells\n<ul>\n<li>Scope and environment for a running isolated process</li>\n<li>Cells do not share memory</li>\n<li>Defined as types with port parameters</li>\n</ul>\n</li>\n</ul>\n<p>Example:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">TYPE</span>\n    Adder <span class=\"token operator\">=</span> cell <span class=\"token punctuation\">(</span>in1<span class=\"token punctuation\">,</span> in2<span class=\"token punctuation\">:</span> port <span class=\"token operator\">in</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">result</span><span class=\"token punctuation\">:</span> port <span class=\"token keyword\">out</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">(* communication ports *)</span>\n    <span class=\"token keyword\">VAR</span> summand1<span class=\"token punctuation\">,</span> summand2<span class=\"token punctuation\">:</span> integer<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">BEGIN</span>\n        in1 ? summand1<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* blocking receive *)</span>\n        in2 ? summand2<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">result</span> ! summand1 <span class=\"token operator\">+</span> summand2<span class=\"token punctuation\">;</span> <span class=\"token comment\">(* non-blocking send *)</span>\n    <span class=\"token keyword\">END</span> Adder<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Cell Constructors to parameterize cells during allocation time:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">TYPE</span>\n    Filter <span class=\"token operator\">=</span> cell <span class=\"token punctuation\">(</span><span class=\"token operator\">in</span><span class=\"token punctuation\">:</span> port <span class=\"token operator\">in</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">result</span><span class=\"token punctuation\">:</span> port <span class=\"token keyword\">out</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">VAR</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span> filterLength<span class=\"token punctuation\">:</span> integer<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">PROCEDURE</span> &amp; Init<span class=\"token punctuation\">(</span>filterLength<span class=\"token punctuation\">:</span> integer<span class=\"token punctuation\">)</span>  <span class=\"token comment\">(* constructor *)</span>\n    <span class=\"token keyword\">BEGIN</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>filterLength <span class=\"token operator\">:=</span> filterLength\n    <span class=\"token keyword\">END</span> Init<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">BEGIN</span>\n    <span class=\"token comment\">(* ... filter action ... *)</span>\n<span class=\"token keyword\">END</span> Filter<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">VAR</span> filter<span class=\"token punctuation\">:</span> Filter<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">BEGIN</span>\n    <span class=\"token operator\">..</span><span class=\"token operator\">..</span> <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">(* initialization parameter filterlength = 32 *)</span></code></pre></div>\n<p>Cells can be parametrized with capabilities or non-default values:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">TYPE</span>\n  <span class=\"token comment\">(* Cell is a VectorTRM with 2k of Data Memory and has access to DDR2 memory *)</span>\n  Filter <span class=\"token operator\">=</span> cell <span class=\"token comment\">{Vector, DataMemory(2048), DDR2}</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">in</span><span class=\"token punctuation\">:</span> port <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">result</span><span class=\"token punctuation\">:</span> port <span class=\"token keyword\">out</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                         <span class=\"token comment\">(* in port is implemented with width of 64 bits *)</span>\n  <span class=\"token keyword\">VAR</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span>\n  <span class=\"token keyword\">BEGIN</span>\n      <span class=\"token comment\">(* ... filter action ... *)</span>\n  <span class=\"token keyword\">END</span> Filter<span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Hierarchic Composition: Cell Nets\n<ul>\n<li>Allocation of cells: <code class=\"language-text\">new</code> statement</li>\n<li>Connection of cells: <code class=\"language-text\">connect</code> statement</li>\n<li>Ports of cells can be delegated to the ports of the net: <code class=\"language-text\">delegate</code> statement</li>\n<li>Terminal or closed Cellnets (i.e Cellnets without ports) can be deployed to hardware</li>\n</ul>\n</li>\n</ul>\n<p>Terminal Cellnet Example</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\">cellnet Example<span class=\"token punctuation\">;</span>\nimport RS232<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">TYPE</span>\n    UserInterface <span class=\"token operator\">=</span> cell <span class=\"token comment\">{RS232}</span><span class=\"token punctuation\">(</span>out1<span class=\"token punctuation\">,</span> out2<span class=\"token punctuation\">:</span> port <span class=\"token keyword\">out</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">in</span><span class=\"token punctuation\">:</span> port <span class=\"token operator\">in</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">(* ... *)</span>\n    <span class=\"token keyword\">END</span> UserInterface<span class=\"token punctuation\">;</span>\n\n    Adder <span class=\"token operator\">=</span> cell<span class=\"token punctuation\">(</span>in1<span class=\"token punctuation\">,</span> in2<span class=\"token punctuation\">:</span> port <span class=\"token operator\">in</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">out</span><span class=\"token punctuation\">:</span> port <span class=\"token keyword\">out</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">(* ... *)</span>\n    <span class=\"token keyword\">END</span> Adder<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">VAR</span> <span class=\"token keyword\">interface</span><span class=\"token punctuation\">:</span> UserInterface<span class=\"token punctuation\">;</span> adder<span class=\"token punctuation\">:</span> Adder\n    <span class=\"token keyword\">BEGIN</span>\n        <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">interface</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>adder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        connect<span class=\"token punctuation\">(</span><span class=\"token keyword\">interface</span><span class=\"token punctuation\">.</span>out1<span class=\"token punctuation\">,</span> adder<span class=\"token punctuation\">.</span>in1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        connect<span class=\"token punctuation\">(</span><span class=\"token keyword\">interface</span><span class=\"token punctuation\">.</span>out2<span class=\"token punctuation\">,</span> adder<span class=\"token punctuation\">.</span>in2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        connect<span class=\"token punctuation\">(</span>adder<span class=\"token punctuation\">.</span><span class=\"token keyword\">result</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">interface</span><span class=\"token punctuation\">.</span><span class=\"token operator\">in</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span> Example<span class=\"token punctuation\">.</span></code></pre></div>\n<ul>\n<li>Communication between cells (CSP)\n<ul>\n<li>Receiving is blocking (<code class=\"language-text\">?</code>)</li>\n<li>Sending is non-blocking (<code class=\"language-text\">!</code>)</li>\n</ul>\n</li>\n<li>Engine Cell Made From Hardware (in HW library for FPGA)</li>\n</ul>\n<p>-Hardware Library\n- Computation Components\n- General purpose minimal machine: TRM, FTRM\n- Vector machine: VTRM\n- MAC, Filters etc.\n- Communication Components (FIFOs)\n- 32 * 128\n- 512 * 128\n- 32, 64, 128, 1k * 32\n- Storage Components\n- DDR2 controller\n- configurable DRAMs\n- CF controller\n- I/O Components\n- UART controller\n- LCD, LED controller\n- SPI, I2C controller\n- VGA, DVI controller</p>\n<!-- End of Notes Week 12 -->\n<!-- Beginning of Notes Week 13 -->\n<h2 id=\"programming-language-vs-hdl\">Programming Language vs. HDL</h2>\n<h3 id=\"programming-language\">Programming Language</h3>\n<ul>\n<li>Sequential execution</li>\n<li>No notion of time</li>\n</ul>\n<p>Example:</p>\n<div class=\"gatsby-highlight\" data-language=\"pascal\"><pre class=\"language-pascal\"><code class=\"language-pascal\"><span class=\"token keyword\">VAR</span> a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">:</span> INTEGER<span class=\"token punctuation\">;</span>\na <span class=\"token operator\">:=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">(* unknown *)</span>\nb <span class=\"token operator\">:=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">(* mapping to *)</span>\nc <span class=\"token operator\">:=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>  <span class=\"token comment\">(* machine cycles *)</span></code></pre></div>\n<h3 id=\"hardware-description-language\">Hardware Description Language</h3>\n<p>Continuous execution (combinational logic):</p>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> c<span class=\"token operator\">=</span>a<span class=\"token operator\">+</span>b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// no</span>\n<span class=\"token keyword\">assign</span> a<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// memory</span>\n<span class=\"token keyword\">assign</span> b<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// associated</span></code></pre></div>\n<p>Synchronous execution (register transfer):</p>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">reg</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">;</span>\n\n<span class=\"token important\">always @</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">begin</span>\n    a <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// synchronous at</span>\n    b <span class=\"token operator\">&lt;=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// rising edge</span>\n    c <span class=\"token operator\">&lt;=</span> a<span class=\"token operator\">+</span>b<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// of the clock</span>\n<span class=\"token keyword\">end</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"singlecycle-datapath-trm\">Single/Cycle Datapath (TRM)</h2>\n<h3 id=\"instruction-fetch\">Instruction Fetch</h3>\n<ul>\n<li>Get value of <em>PC</em></li>\n<li>Get data from instruction memory (36-bit)\n<ul>\n<li>keep only upper or lower part (16-bit)</li>\n<li>depending on value of <em>PC</em></li>\n</ul>\n</li>\n<li>On clock\n<ul>\n<li>if reset: <em>PC</em> := 0</li>\n<li>if stall: <em>PC</em> := <em>PC</em></li>\n<li>else: <em>PC</em> := <em>pcmux</em> (set new <em>PC</em>)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"register-read\">Register Read</h3>\n<p>Read source operands from register file</p>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> rd<span class=\"token punctuation\">,</span> rs<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">wire</span> regWr<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> rdOut<span class=\"token punctuation\">,</span> rsOut<span class=\"token punctuation\">;</span>\nsource register\n\n<span class=\"token comment\">// register file</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">assign</span> irs <span class=\"token operator\">=</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// source register</span>\n<span class=\"token keyword\">assign</span> ird <span class=\"token operator\">=</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">13</span><span class=\"token punctuation\">:</span><span class=\"token number\">11</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> dst <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>BL<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token number\">7</span><span class=\"token punctuation\">:</span> ird<span class=\"token punctuation\">;</span> <span class=\"token comment\">// destination register</span></code></pre></div>\n<ul>\n<li>For <code class=\"language-text\">BL</code> the destination register is always the link register (7)</li>\n<li>Otherwise the registers are read from the instuction register (<em>IR</em>)</li>\n</ul>\n<h3 id=\"alu\">ALU</h3>\n<p>Compute the result via ALU</p>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> AA<span class=\"token punctuation\">,</span> A<span class=\"token punctuation\">,</span> B<span class=\"token punctuation\">,</span> imm<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> aluRes<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">assign</span> A <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> AA<span class=\"token punctuation\">:</span> <span class=\"token operator\">{</span><span class=\"token number\">22'b0</span><span class=\"token punctuation\">,</span> imm<span class=\"token operator\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// bit 10: immediate or register</span>\n\n<span class=\"token keyword\">assign</span> minusA <span class=\"token operator\">=</span> <span class=\"token operator\">{</span><span class=\"token number\">1</span>‘b0<span class=\"token punctuation\">,</span> <span class=\"token operator\">~</span>A<span class=\"token operator\">}</span> <span class=\"token operator\">+</span> <span class=\"token number\">33</span>‘d1<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> aluRes <span class=\"token operator\">=</span>\n<span class=\"token punctuation\">(</span>MOV<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> A<span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>ADD<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token operator\">{</span><span class=\"token number\">1</span>‘b0<span class=\"token punctuation\">,</span> B<span class=\"token operator\">}</span> <span class=\"token operator\">+</span> <span class=\"token operator\">{</span><span class=\"token number\">1</span>‘b0<span class=\"token punctuation\">,</span> A<span class=\"token operator\">}</span> <span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>SUB<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token operator\">{</span><span class=\"token number\">1</span>‘b0<span class=\"token punctuation\">,</span> B<span class=\"token operator\">}</span> <span class=\"token operator\">+</span> minusA <span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>AND<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> B <span class=\"token operator\">&amp;</span> A <span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>BIC<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> B <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>A <span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>OR<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> B <span class=\"token operator\">|</span> A <span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>XOR<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> B <span class=\"token operator\">^</span> A <span class=\"token punctuation\">:</span>\n<span class=\"token operator\">~</span>A<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"control-path\">Control Path</h3>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\">Control Path\n<span class=\"token keyword\">assign</span> vector <span class=\"token operator\">=</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> op <span class=\"token operator\">=</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">assign</span> MOV <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> NOT <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> ADD <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> SUB <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> AND <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> BIC <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> OR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> XOR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> MUL <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">assign</span> ROR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> BR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">assign</span> LDR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> ST <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> Bc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> BL <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> LDH <span class=\"token operator\">=</span> MOV <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">assign</span> BLR <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>op <span class=\"token operator\">==</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<table>\n<thead>\n<tr>\n<th>IR[17:14]</th>\n<th>Function</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0000</td>\n<td>B := A</td>\n</tr>\n<tr>\n<td>0001</td>\n<td>B := ~A</td>\n</tr>\n<tr>\n<td>0010</td>\n<td>B := B + A</td>\n</tr>\n<tr>\n<td>0011</td>\n<td>B := B – A</td>\n</tr>\n<tr>\n<td>0100</td>\n<td>B := B &#x26; A</td>\n</tr>\n<tr>\n<td>0101</td>\n<td>B := B &#x26; ~A</td>\n</tr>\n<tr>\n<td>0110</td>\n<td>B := B</td>\n</tr>\n<tr>\n<td>0111</td>\n<td>B := B ^ A</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"write-result-back-to-rd\">Write Result Back to <code class=\"language-text\">Rd</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> regmux<span class=\"token punctuation\">;</span> <span class=\"token keyword\">wire</span> regwr<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">assign</span> regwr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>BL <span class=\"token operator\">|</span> BLR <span class=\"token operator\">|</span> LDR <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n    <span class=\"token operator\">~</span><span class=\"token punctuation\">(</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>BR <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>vector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>stall0<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">assign</span> regmux <span class=\"token operator\">=</span>\n<span class=\"token punctuation\">(</span>BL <span class=\"token operator\">|</span> BLR<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token operator\">{{{</span><span class=\"token number\">32</span><span class=\"token operator\">-</span>PAW<span class=\"token operator\">}{</span><span class=\"token number\">1'b0</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span> nxpc<span class=\"token operator\">}</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>LDR <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IoenbReg<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> dmout<span class=\"token punctuation\">:</span>  <span class=\"token comment\">// data memory out</span>\n<span class=\"token punctuation\">(</span>LDR <span class=\"token operator\">&amp;</span> IoenbReg<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> InbusReg<span class=\"token punctuation\">:</span> <span class=\"token comment\">// from IO</span>\n<span class=\"token punctuation\">(</span>MUL<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> mulRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>ROR<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> s3<span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">(</span>LDH<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> H<span class=\"token punctuation\">:</span>\naluRes<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"trm-stalling\">TRM Stalling</h3>\n<ul>\n<li>Stop fetching next instruction, <em>pcmux</em> keeps the current value</li>\n<li>Disable register file write enable and memory write enable signals to avoid changing the state of the processor</li>\n<li>Only <code class=\"language-text\">LD</code> and <code class=\"language-text\">MUL</code> instructions stall the processor</li>\n<li><em>dmwe</em> signal is not affected</li>\n<li><em>regwr</em> signal is affected</li>\n</ul>\n<h3 id=\"load-ld\">Load (<code class=\"language-text\">LD</code>)</h3>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> dmout<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span>DAW<span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> dmadr<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> offset<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">reg</span> IoenbReg<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// register file</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token comment\">// src register = lr (7) ignored: harward architecture</span>\nAssign dmadr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>irs <span class=\"token operator\">==</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token operator\">{{{</span>DAW<span class=\"token operator\">-</span><span class=\"token number\">6</span><span class=\"token operator\">}{</span><span class=\"token number\">1'b0</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span> offset<span class=\"token operator\">}</span> <span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span>AA<span class=\"token punctuation\">[</span>DAW<span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token operator\">{{{</span>DAW<span class=\"token operator\">-</span><span class=\"token number\">6</span><span class=\"token operator\">}{</span><span class=\"token number\">1'b0</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span> offset<span class=\"token operator\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> ioenb <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>dmadr<span class=\"token punctuation\">[</span>DAW<span class=\"token punctuation\">:</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// I/O space: uppermost 2^6 bytes in data memory</span>\n<span class=\"token keyword\">assign</span> rfWd <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">(</span>LDR <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IoenbReg<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> dmout<span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span>LDR <span class=\"token operator\">&amp;</span> IoenbReg<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> InbusReg<span class=\"token punctuation\">:</span> <span class=\"token comment\">//from IO</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token important\">always @</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk<span class=\"token punctuation\">)</span>\n    IoenbReg <span class=\"token operator\">&lt;=</span> ioenb<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"store-st\">Store (<code class=\"language-text\">ST</code>)</h3>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token keyword\">wire</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> dmin<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">wire</span> dmwr<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// register file</span>\n<span class=\"token comment\">// ...</span>\n\nDM #<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">BN</span><span class=\"token punctuation\">(</span>DMB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> dmx <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">clk</span><span class=\"token punctuation\">(</span>clk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">wrDat</span><span class=\"token punctuation\">(</span>dmin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">wrAdr</span><span class=\"token punctuation\">(</span><span class=\"token operator\">{{{</span><span class=\"token number\">31</span><span class=\"token operator\">-</span>DAW<span class=\"token operator\">}{</span><span class=\"token number\">1'b0</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span>dmadr<span class=\"token operator\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">rdAdr</span><span class=\"token punctuation\">(</span><span class=\"token operator\">{{{</span><span class=\"token number\">31</span><span class=\"token operator\">-</span>DAW<span class=\"token operator\">}{</span><span class=\"token number\">1'b0</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span>dmadr<span class=\"token operator\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">wrEnb</span><span class=\"token punctuation\">(</span>dmwe<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">rdDat</span><span class=\"token punctuation\">(</span>dmout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">assign</span> dmwe <span class=\"token operator\">=</span> ST <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>ioenb<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">assign</span> dmin <span class=\"token operator\">=</span> B<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"set-flag-registers\">Set Flag Registers</h3>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token important\">always @</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">posedge</span> clk<span class=\"token punctuation\">,</span> <span class=\"token keyword\">negedge</span> rst<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> <span class=\"token comment\">// flags handling</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>rst<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span> N <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> Z <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> C <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> V <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">else</span> <span class=\"token keyword\">begin</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>regwr<span class=\"token punctuation\">)</span> <span class=\"token keyword\">begin</span>\n        N <span class=\"token operator\">&lt;=</span> aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        Z <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        C <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>ROR <span class=\"token operator\">&amp;</span> s3<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>ROR <span class=\"token operator\">&amp;</span> aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        V <span class=\"token operator\">&lt;=</span> ADD <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>A<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>B<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> B<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">|</span> SUB <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>B<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> A<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>B<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>A<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token operator\">~</span>aluRes<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h3 id=\"branch-instructions\">Branch instructions</h3>\n<ul>\n<li><em>PC</em> &#x3C;= <em>PC</em> + 1 + off</li>\n<li><em>PC</em> &#x3C;= <em>Rs</em></li>\n<li><em>PC</em> &#x3C;= <em>PC</em> + 1 (by default)</li>\n<li><em>PC</em> &#x3C;= <em>PC</em> (if stall)</li>\n<li><em>PC</em> &#x3C;= 0 (reset)</li>\n</ul>\n<p>Code:</p>\n<div class=\"gatsby-highlight\" data-language=\"verilog\"><pre class=\"language-verilog\"><code class=\"language-verilog\"><span class=\"token comment\">// pcmux logic</span>\n<span class=\"token keyword\">assign</span> pcmux <span class=\"token operator\">=</span>\n    <span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>rst<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span>stall0<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> PC<span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span>BL<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token operator\">{{</span><span class=\"token number\">10</span><span class=\"token operator\">{</span>IR<span class=\"token punctuation\">[</span>BLS<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span>IR<span class=\"token punctuation\">[</span>BLS<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">}+</span> nxpc <span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span>Bc <span class=\"token operator\">&amp;</span> cond<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token operator\">{{{</span>PAW<span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token operator\">}{</span>IR<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">}}</span><span class=\"token punctuation\">,</span> IR<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">}</span> <span class=\"token operator\">+</span> nxpc <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>BLR <span class=\"token operator\">|</span> BR <span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> A<span class=\"token punctuation\">[</span>PAW<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span>\n    nxpc<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"separate-compilation-trm\">Separate Compilation (TRM)</h3>\n<ul>\n<li>Development environment with separate compilation\n<ul>\n<li>important for commercial products</li>\n<li>state of the art</li>\n</ul>\n</li>\n<li>Very limited architecture\n<ul>\n<li>18-bit instructions</li>\n<li>10-bit immediates</li>\n<li>7-bit memory offset</li>\n<li>10bit (signed) conditional branch offset</li>\n<li>14-bit (+/- 8k) Branch&#x26;Link</li>\n<li>long jumps (chained)</li>\n<li>immediates -> expressed by several instructions or put to memory (fixups)</li>\n<li>fixups, problematic if large global variables are allocated</li>\n</ul>\n-far procedure calls</li>\n<li>Solution: Compilation to Intermediate Code, back-end application at link time</li>\n</ul>\n<h4 id=\"compilation-steps\">Compilation Steps</h4>\n<ol>\n<li>Scanner &#x26; Parser</li>\n<li>Checker</li>\n<li>Intermediate Back-end</li>\n<li>Intermediate Object File</li>\n<li>Active Cells Back-end</li>\n<li>Active Cells Specification, Intermediate Assembler</li>\n<li>Target Back-end</li>\n<li>Generic Object File Linker</li>\n</ol>\n<!-- End Notes Week 13 -->\n<!-- Beginning of Notes Week 14 -->\n<h2 id=\"problems-with-active-cells-1\">Problems with Active Cells 1</h2>\n<ul>\n<li>What if several same HW components available?</li>\n<li>How to extend HW without rewriting compiler each time?</li>\n</ul>\n<h3 id=\"generic-communication-interface\">Generic Communication Interface</h3>\n<ul>\n<li>Peer-to-Peer</li>\n<li>Use of <em>AXI4 Stream</em> interconnect standard from ARM</li>\n<li>Generic, flexible</li>\n<li>Non-redundant</li>\n</ul>\n<h2 id=\"active-cells-2\">Active Cells 2</h2>\n<ul>\n<li>Flexible parameterization of the components using interpreted code in the component specification</li>\n<li>XML-based specification (object persistency)</li>\n</ul>\n<h2 id=\"active-cells-3\">Active Cells 3</h2>\n<ul>\n<li>Parameterization and Description of Hardware completely in one programming language</li>\n</ul>\n<ol>\n<li>Platform specific settings clock sources, pin locations etc</li>\n<li>Component specific settings:\n<ul>\n<li>dependencies (Verilog-Files) parameters</li>\n<li>port names</li>\n<li>Can be made very generic with plugins</li>\n</ul>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f5fdf59a0f3691559e4b65166d26faf/3534c/syscon_active_cells_3_toolchain.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.86075949367089%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9klEQVQoz32TaW/TQBCG8///AnxBSPSgVEh84SjqBVIFLRJp4qRp6viIz7Yx8bXr80EOqRtTxEizs7uaffedd3Z7AHVdt05dYw4Vbs4vuP5+gauMkJ5PTd3J65xZYzTWe5hs2i/Hxb9RcSfXLE2LMor5n21irACFEERRRCoEcRRRFUWbUJUlIknIpCTLMvI8b6OU8inDZlgEC1RVxbEsjNkMKUQLmKYp08mE6dUVmqpimiaapuE4zio24B3ATAiyNEWEIXVedMroaLSiW/3JqZp91t7VsXewu8fR/ltGp19Z3swopKTaaFB7AfBjoHJ6NuTsfMzMjvEX8omOPd92uHdc6oZ6VXXFBvI8o6lCJCm+H2DoDrpm47gBwTIhTRLKsnxk+HA4cD00ZYTav2T6s0/oelSpYDwccnJ0vNKvsSSOMA2duWHgWha6oZNK+QhY1RXlMmRwcMj+s+d83NrhcHePyckXMv8WmUmCIKBYs2i7nwqE5yO9W/JlSLXWf8WwLkoWto2ujAjNObl/h7xfUGb50/dWQ2LZfNre5d2Ll3x+/YbZt3NS3aAQgp57PUU4HtK/pVgE1H/ruPkr1utIM/jwapv3Wzv0D4/xLhXCyZQ8Tug5oyuE7RKbc+K51VL/17d6iGWec6cbOMoYa6AQzW2KJFmV/Bu1MZR8LAfkjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Active Cells 3 Toolchain\"\n        title=\"Active Cells 3 Toolchain\"\n        src=\"/static/2f5fdf59a0f3691559e4b65166d26faf/f058b/syscon_active_cells_3_toolchain.png\"\n        srcset=\"/static/2f5fdf59a0f3691559e4b65166d26faf/c26ae/syscon_active_cells_3_toolchain.png 158w,\n/static/2f5fdf59a0f3691559e4b65166d26faf/6bdcf/syscon_active_cells_3_toolchain.png 315w,\n/static/2f5fdf59a0f3691559e4b65166d26faf/f058b/syscon_active_cells_3_toolchain.png 630w,\n/static/2f5fdf59a0f3691559e4b65166d26faf/3534c/syscon_active_cells_3_toolchain.png 808w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>This image is taken from the lecture slides provided by Felix Friedrich</p>\n<!-- End of Notes Week 14 -->\n<!-- End of Course -->","frontmatter":{"title":"System Construction","tags":["ETH","Assembler"],"category":"Programming"},"headings":[{"depth":1,"value":"Minos on Raspberry PI 2 (Case Study 1)"},{"depth":2,"value":"ARM A7"},{"depth":3,"value":"Documentation"},{"depth":3,"value":"6 Kinds Of Instructions"},{"depth":3,"value":"Execution Modes"},{"depth":3,"value":"Special Registers"},{"depth":3,"value":"Typical Procedure Call"},{"depth":3,"value":"Exceptions"},{"depth":3,"value":"Misc"},{"depth":2,"value":"Raspberry PI 2"},{"depth":3,"value":"Booting"},{"depth":3,"value":"MMU"},{"depth":3,"value":"GPIO"},{"depth":2,"value":"Minos and Oberon"},{"depth":3,"value":"History of Oberon"},{"depth":3,"value":"Oberon"},{"depth":4,"value":"Oberon07"},{"depth":4,"value":"Language Constructs"},{"depth":5,"value":"Program Units"},{"depth":5,"value":"Data Types"},{"depth":5,"value":"Structured Types"},{"depth":5,"value":"Control Structures"},{"depth":6,"value":"<code class=\"language-text\">IF</code>"},{"depth":6,"value":"<code class=\"language-text\">WHILE</code>"},{"depth":6,"value":"<code class=\"language-text\">REPEAT</code>"},{"depth":6,"value":"<code class=\"language-text\">FOR</code>"},{"depth":5,"value":"Built-in Functions"},{"depth":4,"value":"Modules"},{"depth":4,"value":"Pseudo Module <code class=\"language-text\">SYSTEM</code>"},{"depth":5,"value":"<code class=\"language-text\">SYSTEM</code>: ARM Specific"},{"depth":5,"value":"Interrupt Procedures"},{"depth":5,"value":"Special Flags and Features"},{"depth":5,"value":"Type Declarations"},{"depth":5,"value":"Inheritance"},{"depth":5,"value":"Run-time Support for Inheritance"},{"depth":4,"value":"Module Loading and Commands"},{"depth":4,"value":"Compilation and Linking"},{"depth":4,"value":"Object File Format"},{"depth":4,"value":"Boot-file"},{"depth":3,"value":"Minos Kernel"},{"depth":4,"value":"System Start-up"},{"depth":4,"value":"Initialisation of Interrupts"},{"depth":4,"value":"Task Scheduling (Minos)"},{"depth":5,"value":"Stack (Minos)"},{"depth":5,"value":"Scheduler (Minos)"},{"depth":2,"value":"Serial Communication"},{"depth":3,"value":"SPI"},{"depth":4,"value":"Setup"},{"depth":3,"value":"UART"},{"depth":1,"value":"A2 (Case Study 2)"},{"depth":2,"value":"Intel x86"},{"depth":3,"value":"Resources (x86 compatible HW)"},{"depth":3,"value":"Interrupt System (x86)"},{"depth":4,"value":"APIC"},{"depth":4,"value":"MultiProcessor Specification"},{"depth":4,"value":"Exception Numbers"},{"depth":4,"value":"Configuring APIC"},{"depth":3,"value":"PCI Local Bus"},{"depth":2,"value":"Active Oberon Language"},{"depth":3,"value":"Locks vs. Monitors"},{"depth":3,"value":"Threads vs. Active Objects"},{"depth":3,"value":"Object Model (Active Oberon)"},{"depth":3,"value":"Signal-Wait Implementations"},{"depth":3,"value":"Monitors in Active Oberon"},{"depth":2,"value":"Active Object System (A2)"},{"depth":3,"value":"Modular Kernel Structure"},{"depth":3,"value":"Atomic Operations (HW Support)"},{"depth":4,"value":"Intel (x86)"},{"depth":4,"value":"ARM"},{"depth":4,"value":"Overview"},{"depth":4,"value":"Compare-And-Swap (CAS)"},{"depth":4,"value":"Implementation of a spinal using CAS"},{"depth":3,"value":"Boot Procedure (A2)"},{"depth":4,"value":"Processor Startup"},{"depth":3,"value":"A2 Activities States"},{"depth":3,"value":"Run-Time Data Structures"},{"depth":3,"value":"Stack Management"},{"depth":3,"value":"Context Switch"},{"depth":4,"value":"Coroutines (Synchronous)"},{"depth":4,"value":"Asynchronous Context Switch"},{"depth":3,"value":"Synchronisation"},{"depth":4,"value":"Object Locking"},{"depth":4,"value":"Priority Inversion"},{"depth":4,"value":"Priority Inheritance"},{"depth":3,"value":"Lock-Free Programming"},{"depth":4,"value":"A2"},{"depth":5,"value":"Goals"},{"depth":5,"value":"Guiding Principles"},{"depth":5,"value":"Lock-Free Kernel"},{"depth":5,"value":"Memory Model for Lock-Free Active Oberon"},{"depth":4,"value":"ABA Problem"},{"depth":5,"value":"Hazard Pointers"},{"depth":3,"value":"Cooperative Multitasking (implicit)"},{"depth":4,"value":"Interrupts"},{"depth":4,"value":"Queue Data Structures"},{"depth":5,"value":"Scheduling (Activities)"},{"depth":5,"value":"Task Switch Finalizer"},{"depth":4,"value":"Stack Management"},{"depth":5,"value":"Interrupts"},{"depth":5,"value":"Lock-Free Memory Management"},{"depth":3,"value":"Portability"},{"depth":1,"value":"Oberon RISC (Case Study 3)"},{"depth":1,"value":"Active Cells (Case Study 4)"},{"depth":2,"value":"Tiny Register Machine (TRM)"},{"depth":2,"value":"Active Cells"},{"depth":2,"value":"Programming Language vs. HDL"},{"depth":3,"value":"Programming Language"},{"depth":3,"value":"Hardware Description Language"},{"depth":2,"value":"Single/Cycle Datapath (TRM)"},{"depth":3,"value":"Instruction Fetch"},{"depth":3,"value":"Register Read"},{"depth":3,"value":"ALU"},{"depth":3,"value":"Control Path"},{"depth":3,"value":"Write Result Back to <code class=\"language-text\">Rd</code>"},{"depth":3,"value":"TRM Stalling"},{"depth":3,"value":"Load (<code class=\"language-text\">LD</code>)"},{"depth":3,"value":"Store (<code class=\"language-text\">ST</code>)"},{"depth":3,"value":"Set Flag Registers"},{"depth":3,"value":"Branch instructions"},{"depth":3,"value":"Separate Compilation (TRM)"},{"depth":4,"value":"Compilation Steps"},{"depth":2,"value":"Problems with Active Cells 1"},{"depth":3,"value":"Generic Communication Interface"},{"depth":2,"value":"Active Cells 2"},{"depth":2,"value":"Active Cells 3"}]}},"pageContext":{"id":"e3dd2f48-11c2-5cf6-8bac-bc471905ee34","previousPost":{"title":"Distance Functions and Metrics","slug":"/blog/distance_functions"},"nextPost":{"title":"Hardware-Software Codesign","slug":"/blog/hw_sw_codesign"},"dates":{"created":1446931250,"modified":1647509701}}},
    "staticQueryHashes": []}